{"version":3,"sources":["webpack://splunktracing/webpack/universalModuleDefinition","webpack://splunktracing/webpack/bootstrap","webpack://splunktracing/./node_modules/eventemitter3/index.js","webpack://splunktracing/./node_modules/hex2dec/index.js","webpack://splunktracing/./node_modules/opentracing/lib/binary_carrier.js","webpack://splunktracing/./node_modules/opentracing/lib/constants.js","webpack://splunktracing/./node_modules/opentracing/lib/ext/tags.js","webpack://splunktracing/./node_modules/opentracing/lib/functions.js","webpack://splunktracing/./node_modules/opentracing/lib/global_tracer.js","webpack://splunktracing/./node_modules/opentracing/lib/index.js","webpack://splunktracing/./node_modules/opentracing/lib/mock_tracer/index.js","webpack://splunktracing/./node_modules/opentracing/lib/mock_tracer/mock_context.js","webpack://splunktracing/./node_modules/opentracing/lib/mock_tracer/mock_report.js","webpack://splunktracing/./node_modules/opentracing/lib/mock_tracer/mock_span.js","webpack://splunktracing/./node_modules/opentracing/lib/mock_tracer/mock_tracer.js","webpack://splunktracing/./node_modules/opentracing/lib/noop.js","webpack://splunktracing/./node_modules/opentracing/lib/reference.js","webpack://splunktracing/./node_modules/opentracing/lib/span.js","webpack://splunktracing/./node_modules/opentracing/lib/span_context.js","webpack://splunktracing/./node_modules/opentracing/lib/tracer.js","webpack://splunktracing/./src/_each.js","webpack://splunktracing/./src/constants.js","webpack://splunktracing/./src/imp/auth_imp.js","webpack://splunktracing/./src/imp/coerce.js","webpack://splunktracing/./src/imp/globals.js","webpack://splunktracing/./src/imp/log_builder.js","webpack://splunktracing/./src/imp/log_record_imp.js","webpack://splunktracing/./src/imp/platform/browser/options_parser.js","webpack://splunktracing/./src/imp/platform/browser/platform_browser.js","webpack://splunktracing/./src/imp/platform/browser/transport_httpjson.js","webpack://splunktracing/./src/imp/platform/browser/util.js","webpack://splunktracing/./src/imp/report_imp.js","webpack://splunktracing/./src/imp/runtime_imp.js","webpack://splunktracing/./src/imp/span_context_imp.js","webpack://splunktracing/./src/imp/span_imp.js","webpack://splunktracing/./src/imp/tracer_imp.js","webpack://splunktracing/./src/imp/util/clock_state.js","webpack://splunktracing/./src/imp/util/util.js","webpack://splunktracing/./src/lib.js","webpack://splunktracing/./src/platform_abstraction_layer.js","webpack://splunktracing/./src/plugins/instrument_document_load.js","webpack://splunktracing/./src/plugins/instrument_fetch.js","webpack://splunktracing/./src/plugins/instrument_xhr.js","webpack://splunktracing/./src/plugins/log_to_console.js"],"names":["_each","obj","cb","key","hasOwnProperty","call","LOG_INFO","LOG_WARN","LOG_ERROR","LOG_FATAL","LOG_LEVEL_TO_STRING","LOG_STRING_TO_LEVEL","I","W","E","F","CLOCK_STATE_REFRESH_INTERVAL_MS","SPLUNK_APP_URL_PREFIX","JOIN_ID_PREFIX","SPL_META_EVENT_KEY","SPL_META_PROPAGATION_KEY","SPL_META_TRACE_KEY","SPL_META_SPAN_KEY","SPL_META_TRACER_GUID_KEY","SPL_META_EXTRACT","SPL_META_INJECT","SPL_META_SP_START","SPL_META_SP_FINISH","SPL_META_TRACER_CREATE","AuthImp","accessToken","_accessToken","length","toString","toNumber","toBoolean","value","Number","PackageGlobals","options","opts","val","module","exports","constants","require","coerce","LogBuilder","runtime","_runtime","_record","timestamp_micros","_platform","nowMicros","runtime_guid","span_guid","stable_name","message","level","thread_id","filename","line_number","stack_frames","payload_json","error_flag","_addLogRecord","micros","msg","num","error","guid","undefined","stableName","flag","data","_encodePayload","payloadJSON","JSON","stringify","_ignored","LogRecordImp","logFieldKeyHardLimit","logFieldValueHardLimit","timestampMicros","fields","Error","stack","_logFieldKeyHardLimit","_logFieldValueHardLimit","_timestampMicros","_fields","_keysOverLimit","_valuesOverLimit","_clearOverLimits","thriftFields","keyStr","getFieldKey","valStr","getFieldValue","push","crouton_thrift","KeyValue","Key","Value","LogRecord","substr","Object","getOwnPropertyNames","e","log","proto","Log","ts","googleProtobufTimestampPB","Timestamp","millis","Math","floor","secs","nanos","setSeconds","setNanos","setTimestamp","keyValues","keyValue","setKey","setStringValue","setFieldsList","hostScriptElement","WorkerGlobalScope","self","scripts","document","getElementsByTagName","urlQueryParameters","defaults","vars","qi","window","location","href","indexOf","slice","hashes","replace","split","i","hash","decodeURIComponent","parseScriptElementOptions","browserOpts","dataset","access_token","componentName","component_name","collectorHost","collector_host","collectorPort","collector_port","parseInt","collectorPath","collector_path","collectorEncryption","collector_encryption","enable","verbosity","init","init_global_tracer","xhr_instrumentation","instrument_page_load","parseURLQueryOptions","params","splunk_verbosity","splunk_log_to_console","log_to_console","optionsParser","util","kRuntimeGUIDCookiePrefix","kSessionIDCookieKey","kCookieTimeToLiveSeconds","nowMicrosImp","performance","now","timing","navigationStart","start","Date","PlatformBrowser","groupName","cookieKey","uuid","cookie","_generateLongUUID","sessionID","p0","abs","random","p1","args","addEventListener","imp","tracerOpts","sessionStorage","parse","getItem","setItem","lib","initGlobalTracer","opentracing","Tracer","TransportBrowser","_host","_port","_encryption","_access_token","detached","auth","report","done","_reportAJAX","reportJSON","toJSON","protocol","url","xhr","XMLHttpRequest","responseType","open","setRequestHeader","onreadystatechange","readyState","err","resp","status","response","exception","serialized","join","send","name","ttl","path","domain","secure","arguments","newCookie","encodeURIComponent","toUTCString","ReportImp","oldestMicros","youngestMicros","spanRecords","internalLogs","counters","timestampOffsetMicros","_oldestMicros","_youngestMicros","_spanRecords","_internalLogs","_counters","_timestampOffsetMicros","span","_runtimeGUID","jsonSpanRecords","spanRecord","_toJSON","RuntimeImp","runtimeGUID","startMicros","attributes","_startMicros","_componentName","_attributes","start_micros","group_name","attrs","SpanContextImp","_baggage","f","spanGUID","traceGUID","_guid","_traceGUID","converter","SpanImp","_tracerImp","_ctx","_operationName","keyValuePairs","_tags","timestamp","argumentType","_error","tsMicros","record","getLogFieldKeyHardLimit","getLogFieldValueHardLimit","_log_records","emit","finishTime","end","tracer","spanContext","console","assert","_ended","_beginMicros","_endMicros","_errorFlag","parent_span_guid","urlPrefix","setEndMicros","shouldSendMetaSpan","_tracer","getTags","startSpan","tags","finish","_addSpanRecord","obj_array","json_span","event","span_id","trace_id","parent_span_id","parentGUID","baggage","_options","operation_name","duration","sourcetype","time","json_log","value1","key1","Span","ClockState","globals","packageObject","CARRIER_TRACER_STATE_PREFIX","CARRIER_BAGGAGE_PREFIX","DEFAULT_COLLECTOR_HOSTNAME","DEFAULT_COLLECTOR_PORT_TLS","DEFAULT_COLLECTOR_PORT_PLAIN","DEFAULT_COLLECTOR_PATH","MAX_INTERNAL_LOGS","_singleton","_delegateEventEmitterMethods","setOptions","override_runtime_guid","_plugins","_optionDescs","_makeOptionsTable","_opentracing","opentracing_module","_auth","logger","warn","payload","_warn","_transport","override_transport","_reportingLoopActive","_first_report_has_run","_reportYoungestMicros","_reportTimer","_reportErrorStreak","_lastVisibleErrorMillis","_skippedVisibleErrors","_activeRootSpanSet","_activeRootSpan","_flushIsActive","addPlugin","addPlatformPlugins","setPlatformOptions","transport","_info","_useClockState","disable_clock_skew_correction","_clockState","localStoreGet","localStoreSet","_setupReportOnExit","startPlugins","_ee","methodName","apply","addOption","type","min","max","defaultValue","_printToConsole","bind","parentCtxImp","references","ref","REFERENCE_CHILD_OF","REFERENCE_FOLLOWS_FROM","context","referencedContext","generateTraceGUIDForRootSpan","spanImp","generateUUID","addTags","default_span_tags","setBeginMicros","setParentGUID","format","carrier","FORMAT_HTTP_HEADERS","FORMAT_TEXT_MAP","meta_event_reporting","_injectToTextMap","FORMAT_BINARY","forEachBaggageItem","sc","_extractTextMap","foundFields","toLowerCase","suffix","setBaggageItem","disabled","_flushReport","v","userOptions","desc","modified","unchanged","_setOptionInternal","_initReportingDataIfNeeded","_startReportingLoop","optionsString","count","newValue","_debug","valueType","prototype","oldValue","version","platformTags","tracerTags","getAccessToken","log_field_key_hard_limit","log_field_value_hard_limit","pluginSet","plugins","plugin","addOptions","_setActiveRootSpanToYoungest","jsonString","buffer","ArrayBuffer","view","Uint8Array","code","charCodeAt","arr","String","fromCharCode","b","unused","countersAllZero","_internalAddSpanRecord","max_span_records","index","spans","currentInternalLogs","toAdd","concat","_pushInternalLog","disable_report_on_exit","finalFlushOnce","finalFlush","unflushed_spans","buffer_youngest_micros","onBeforeExit","disable_reporting_loop","stopReportingOnce","stopReporting","_stopReportingLoop","loop","_enqueueNextReport","delay","delay_initial_report_millis","detachedTimeout","clearTimeout","reportInterval","max_reporting_interval_millis","isReady","backOff","basis","jitter","manual","clockReady","clockOffsetMicros","offsetMicros","offset_micros","active_samples","activeSampleCount","ready","_buffersAreEmpty","_clearBuffers","ensureConnection","timestampOffset","originMicros","res","destinationMicros","reportWindowSeconds","oldest_micros","errString","last_report_seconds_ago","_restoreRecords","getSpanRecords","getInternalLogs","getCounters","streak","spans_reported","receive_micros","transmit_micros","addSample","errors","commandsList","devMode","disable_meta_event_reporting","nextVisible","error_throttle_millis","s","method","silent","kMaxOffsetAge","kStoredSamplesTTLMicros","_nowMicros","_localStoreGet","_localStoreSet","_samples","_currentOffsetMicros","_currentOffsetAge","storedData","samples","update","receiveMicros","transmitMicros","latestDelayMicros","MAX_VALUE","latestOffsetMicros","shift","delayMicros","minDelayMicros","bestOffsetMicros","sample","pow","sqrt","kSGATE","Util","callback","timer","setTimeout","unref","shouldSendSpan","library","initLibrary","Platform","HTTPTransport","InstrumentPageLoad","_inited","_span","tracerImp","currentOptions","_ensureSpanStarted","_handleReadyStateChange","addActiveRootSpan","state","_addTimingSpans","logEvent","removeActiveRootSpan","nav","dst","p","item","description","suffixes","parentImp","setTag","navigator","userAgent","_copyNavigatorProperties","childOf","requestStart","responseStart","responseEnd","domLoading","domInteractive","proxiedFetch","fetch","getCookies","cookies","parts","getResponseHeaders","result","pair","headers","entries","InstrumentFetch","_enabled","_isValidContext","_proxyInited","_internalExclusions","_handleOptions","_addServiceHostToExclusions","on","current","serviceHost","fetch_instrumentation","_instrumentFetch","escapeRegExp","str","host","port","set","RegExp","request","_shouldTrace","url_pathname","fetchPayload","assign","include_cookies","Headers","headersCarrier","inject","keys","forEach","append","openPayload","then","ok","statusText","catch","ex","test","include","fetch_url_inclusion_patterns","inc","fetch_url_exclusion_patterns","proxied","raw","getAllResponseHeaders","InstrumentXHR","_instrumentSetRequestHeader","_instrumentOpen","_instrumentSend","header","__requestHeaders","asyncArg","user","password","__tracer_span","__tracer_url","async","Array","len","lenStr","data_length","xhr_url_inclusion_patterns","xhr_url_exclusion_patterns","LogToConsole","_optionsCb","_logAddedCb","_handleLogAdded","removeListener","enabled"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;;AAEzB;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,0DAA0D,OAAO;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yCAAyC,SAAS;AAClD;AACA;;AAEA;AACA,GAAG;AACH;AACA;;AAEA,eAAe,YAAY;AAC3B;;AAEA;AACA,2DAA2D;AAC3D,+DAA+D;AAC/D,mEAAmE;AACnE;AACA,0DAA0D,SAAS;AACnE;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,QAAQ;AACnB,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,WAAW,MAAM;AACjB,WAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,gDAAgD,YAAY;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA,iCAAiC;;AAEjC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI,IAA6B;AACjC;AACA;;;;;;;;;;;;ACrQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,mBAAmB;AACpC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mCAAmC,QAAQ;AAC3C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACnGa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,0C;;;;;;;;;;;;ACfa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qC;;;;;;;;;;;;AC9Da;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gC;;;;;;;;;;;;AC3Ga;AACb,8CAA8C,cAAc;AAC5D,gBAAgB,mBAAO,CAAC,gEAAa;AACrC,kBAAkB,mBAAO,CAAC,gEAAa;AACvC,aAAa,mBAAO,CAAC,sDAAQ;AAC7B;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qC;;;;;;;;;;;;ACnCa;AACb;AACA;AACA,UAAU,gBAAgB,sCAAsC,iBAAiB,EAAE;AACnF,yBAAyB,uDAAuD;AAChF;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,eAAe,mBAAO,CAAC,0DAAU;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yC;;;;;;;;;;;;ACpEa;AACb;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D,uBAAuB,mBAAO,CAAC,0EAAkB;AACjD;AACA,WAAW,mBAAO,CAAC,8DAAY;AAC/B;AACA,WAAW,mBAAO,CAAC,sDAAQ;AAC3B,kBAAkB,mBAAO,CAAC,gEAAa;AACvC;AACA,aAAa,mBAAO,CAAC,sDAAQ;AAC7B;AACA,qBAAqB,mBAAO,CAAC,sEAAgB;AAC7C;AACA,eAAe,mBAAO,CAAC,0DAAU;AACjC;AACA,oBAAoB,mBAAO,CAAC,0EAAe;AAC3C;AACA,SAAS,mBAAO,CAAC,wEAAiB;AAClC,SAAS,mBAAO,CAAC,gEAAa;AAC9B,SAAS,mBAAO,CAAC,gEAAa;AAC9B;AACA;AACA,iC;;;;;;;;;;;;ACzBa;AACb,8CAA8C,cAAc;AAC5D,qBAAqB,mBAAO,CAAC,kFAAgB;AAC7C;AACA,kBAAkB,mBAAO,CAAC,4EAAa;AACvC;AACA,oBAAoB,mBAAO,CAAC,gFAAe;AAC3C;AACA,iC;;;;;;;;;;;;ACRa;AACb;AACA;AACA,UAAU,gBAAgB,sCAAsC,iBAAiB,EAAE;AACnF,yBAAyB,uDAAuD;AAChF;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,kBAAkB,mBAAO,CAAC,yDAAU;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,wC;;;;;;;;;;;;ACjCa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,uC;;;;;;;;;;;;AC5Ca;AACb;AACA;AACA;AACA,UAAU,gBAAgB,sCAAsC,iBAAiB,EAAE;AACnF,yBAAyB,uDAAuD;AAChF;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D,kBAAkB,mBAAO,CAAC,yDAAU;AACpC,qBAAqB,mBAAO,CAAC,kFAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,oBAAoB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,qC;;;;;;;;;;;;ACnGa;AACb;AACA;AACA,UAAU,gBAAgB,sCAAsC,iBAAiB,EAAE;AACnF,yBAAyB,uDAAuD;AAChF;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,8CAA8C,cAAc;AAC5D;AACA,kBAAkB,mBAAO,CAAC,yDAAU;AACpC,oBAAoB,mBAAO,CAAC,gFAAe;AAC3C,kBAAkB,mBAAO,CAAC,4EAAa;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,gBAAgB;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,uC;;;;;;;;;;;;AC3Ea;AACb,8CAA8C,cAAc;AAC5D,aAAa,mBAAO,CAAC,sDAAQ;AAC7B,qBAAqB,mBAAO,CAAC,sEAAgB;AAC7C,eAAe,mBAAO,CAAC,0DAAU;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gC;;;;;;;;;;;;AChBa;AACb,8CAA8C,cAAc;AAC5D,aAAa,mBAAO,CAAC,sDAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA,eAAe,YAAY;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA,qC;;;;;;;;;;;;AC1Ca;AACb,8CAA8C,cAAc;AAC5D,WAAW,mBAAO,CAAC,sDAAQ;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,IAAI;AACnB;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,YAAY;AACZ;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,qCAAqC;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,gC;;;;;;;;;;;;AC9Ma;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,wC;;;;;;;;;;;;ACnBa;AACb,8CAA8C,cAAc;AAC5D,gBAAgB,mBAAO,CAAC,gEAAa;AACrC,WAAW,mBAAO,CAAC,sDAAQ;AAC3B,aAAa,mBAAO,CAAC,sDAAQ;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA,eAAe,OAAO;AACtB,eAAe,YAAY;AAC3B,gBAAgB,KAAK;AACrB;AACA;AACA,iCAAiC,cAAc;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA,gBAAgB,OAAO;AACvB,gBAAgB,IAAI;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,oBAAoB;AACzE;AACA,gBAAgB,OAAO;AACvB,gBAAgB,IAAI;AACpB;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"splunk-tracer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"splunktracing\"] = factory();\n\telse\n\t\troot[\"splunktracing\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/lib.js\");\n","'use strict';\n\n//\n// We store our EE objects in a plain object whose properties are event names.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// `~` to make sure that the built-in object properties are not overridden or\n// used as an attack vector.\n// We also assume that `Object.create(null)` is available when the event name\n// is an ES6 Symbol.\n//\nvar prefix = typeof Object.create !== 'function' ? '~' : false;\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} once Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Holds the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @param {Boolean} exists We only need to know if there are listeners.\n * @returns {Array|Boolean}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event, exists) {\n  var evt = prefix ? prefix + event : event\n    , available = this._events && this._events[evt];\n\n  if (exists) return !!available;\n  if (!available) return [];\n  if (available.fn) return [available.fn];\n\n  for (var i = 0, l = available.length, ee = new Array(l); i < l; i++) {\n    ee[i] = available[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if ('function' === typeof listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Functon} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  var listener = new EE(fn, context || this)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} context The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  var listener = new EE(fn, context || this, true)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Mixed} context Only remove listeners matching this context.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return this;\n\n  var listeners = this._events[evt]\n    , events = [];\n\n  if (fn) {\n    if (listeners.fn) {\n      if (\n           listeners.fn !== fn\n        || (once && !listeners.once)\n        || (context && listeners.context !== context)\n      ) {\n        events.push(listeners);\n      }\n    } else {\n      for (var i = 0, length = listeners.length; i < length; i++) {\n        if (\n             listeners[i].fn !== fn\n          || (once && !listeners[i].once)\n          || (context && listeners[i].context !== context)\n        ) {\n          events.push(listeners[i]);\n        }\n      }\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) {\n    this._events[evt] = events.length === 1 ? events[0] : events;\n  } else {\n    delete this._events[evt];\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) delete this._events[prefix ? prefix + event : event];\n  else this._events = prefix ? {} : Object.create(null);\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * A function for converting hex <-> dec w/o loss of precision.\n *\n * The problem is that parseInt(\"0x12345...\") isn't precise enough to convert\n * 64-bit integers correctly.\n *\n * Internally, this uses arrays to encode decimal digits starting with the least\n * significant:\n * 8 = [8]\n * 16 = [6, 1]\n * 1024 = [4, 2, 0, 1]\n *\n * Source: http://www.danvk.org/hex2dec.html\n */\n\n// Adds two arrays for the given base (10 or 16), returning the result.\n// This turns out to be the only \"primitive\" operation we need.\nfunction add(x, y, base) {\n  var z = [];\n  var n = Math.max(x.length, y.length);\n  var carry = 0;\n  var i = 0;\n  while (i < n || carry) {\n    var xi = i < x.length ? x[i] : 0;\n    var yi = i < y.length ? y[i] : 0;\n    var zi = carry + xi + yi;\n    z.push(zi % base);\n    carry = Math.floor(zi / base);\n    i++;\n  }\n  return z;\n}\n\n// Returns a*x, where x is an array of decimal digits and a is an ordinary\n// JavaScript number. base is the number base of the array x.\nfunction multiplyByNumber(num, x, base) {\n  if (num < 0) return null;\n  if (num == 0) return [];\n\n  var result = [];\n  var power = x;\n  while (true) {\n    if (num & 1) {\n      result = add(result, power, base);\n    }\n    num = num >> 1;\n    if (num === 0) break;\n    power = add(power, power, base);\n  }\n\n  return result;\n}\n\nfunction parseToDigitsArray(str, base) {\n  var digits = str.split('');\n  var ary = [];\n  for (var i = digits.length - 1; i >= 0; i--) {\n    var n = parseInt(digits[i], base);\n    if (isNaN(n)) return null;\n    ary.push(n);\n  }\n  return ary;\n}\n\nfunction convertBase(str, fromBase, toBase) {\n  var digits = parseToDigitsArray(str, fromBase);\n  if (digits === null) return null;\n\n  var outArray = [];\n  var power = [1];\n  for (var i = 0; i < digits.length; i++) {\n    // invariant: at this point, fromBase^i = power\n    if (digits[i]) {\n      outArray = add(outArray, multiplyByNumber(digits[i], power, toBase), toBase);\n    }\n    power = multiplyByNumber(fromBase, power, toBase);\n  }\n\n  var out = '';\n  for (var i = outArray.length - 1; i >= 0; i--) {\n    out += outArray[i].toString(toBase);\n  }\n  return out;\n}\n\nfunction decToHex(decStr) {\n  var hex = convertBase(decStr, 10, 16);\n  return hex ? '0x' + hex : null;\n}\n\nfunction hexToDec(hexStr) {\n  if (hexStr.substring(0, 2) === '0x') hexStr = hexStr.substring(2);\n  hexStr = hexStr.toLowerCase();\n  return convertBase(hexStr, 16, 10);\n}\n\nmodule.exports = {\n  hexToDec: hexToDec,\n  decToHex: decToHex\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Convenience class to use as a binary carrier.\n *\n * Any valid Object with a field named `buffer` may be used as a binary carrier;\n * this class is only one such type of object that can be used.\n */\nvar BinaryCarrier = /** @class */ (function () {\n    function BinaryCarrier(buffer) {\n        this.buffer = buffer;\n    }\n    return BinaryCarrier;\n}());\nexports.default = BinaryCarrier;\n//# sourceMappingURL=binary_carrier.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The FORMAT_BINARY format represents SpanContexts in an opaque binary\n * carrier.\n *\n * Tracer.inject() will set the buffer field to an Array-like (Array,\n * ArrayBuffer, or TypedBuffer) object containing the injected binary data.\n * Any valid Object can be used as long as the buffer field of the object\n * can be set.\n *\n * Tracer.extract() will look for `carrier.buffer`, and that field is\n * expected to be an Array-like object (Array, ArrayBuffer, or\n * TypedBuffer).\n */\nexports.FORMAT_BINARY = 'binary';\n/**\n * The FORMAT_TEXT_MAP format represents SpanContexts using a\n * string->string map (backed by a Javascript Object) as a carrier.\n *\n * NOTE: Unlike FORMAT_HTTP_HEADERS, FORMAT_TEXT_MAP places no restrictions\n * on the characters used in either the keys or the values of the map\n * entries.\n *\n * The FORMAT_TEXT_MAP carrier map may contain unrelated data (e.g.,\n * arbitrary gRPC metadata); as such, the Tracer implementation should use\n * a prefix or other convention to distinguish Tracer-specific key:value\n * pairs.\n */\nexports.FORMAT_TEXT_MAP = 'text_map';\n/**\n * The FORMAT_HTTP_HEADERS format represents SpanContexts using a\n * character-restricted string->string map (backed by a Javascript Object)\n * as a carrier.\n *\n * Keys and values in the FORMAT_HTTP_HEADERS carrier must be suitable for\n * use as HTTP headers (without modification or further escaping). That is,\n * the keys have a greatly restricted character set, casing for the keys\n * may not be preserved by various intermediaries, and the values should be\n * URL-escaped.\n *\n * The FORMAT_HTTP_HEADERS carrier map may contain unrelated data (e.g.,\n * arbitrary HTTP headers); as such, the Tracer implementation should use a\n * prefix or other convention to distinguish Tracer-specific key:value\n * pairs.\n */\nexports.FORMAT_HTTP_HEADERS = 'http_headers';\n/**\n * A Span may be the \"child of\" a parent Span. In a “child of” reference,\n * the parent Span depends on the child Span in some capacity.\n *\n * See more about reference types at https://github.com/opentracing/specification\n */\nexports.REFERENCE_CHILD_OF = 'child_of';\n/**\n * Some parent Spans do not depend in any way on the result of their child\n * Spans. In these cases, we say merely that the child Span “follows from”\n * the parent Span in a causal sense.\n *\n * See more about reference types at https://github.com/opentracing/specification\n */\nexports.REFERENCE_FOLLOWS_FROM = 'follows_from';\n//# sourceMappingURL=constants.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/** SPAN_KIND hints at relationship between spans, e.g. client/server */\nexports.SPAN_KIND = 'span.kind';\n/** Marks a span representing the client-side of an RPC or other remote call */\nexports.SPAN_KIND_RPC_CLIENT = 'client';\n/** Marks a span representing the server-side of an RPC or other remote call */\nexports.SPAN_KIND_RPC_SERVER = 'server';\n/** Marks a span representing the producing-side within a messaging system or other remote call */\nexports.SPAN_KIND_MESSAGING_PRODUCER = 'producer';\n/** Marks a span representing the consuming-side within a messaging system or other remote call */\nexports.SPAN_KIND_MESSAGING_CONSUMER = 'consumer';\n/**\n * ERROR (boolean) true if and only if the application considers the operation\n * represented by the Span to have failed\n */\nexports.ERROR = 'error';\n/**\n * COMPONENT (string) ia s low-cardinality identifier of the module, library,\n * or package that is generating a span.\n */\nexports.COMPONENT = 'component';\n/**\n * SAMPLING_PRIORITY (number) determines the priority of sampling this Span.\n * If greater than 0, a hint to the Tracer to do its best to capture the trace.\n * If 0, a hint to the trace to not-capture the trace. If absent, the Tracer\n * should use its default sampling mechanism.\n */\nexports.SAMPLING_PRIORITY = 'sampling.priority';\n// ---------------------------------------------------------------------------\n// PEER_* tags can be emitted by either client-side of server-side to describe\n// the other side/service in a peer-to-peer communications, like an RPC call.\n// ---------------------------------------------------------------------------\n/**\n * PEER_SERVICE (string) Remote service name (for some unspecified\n * definition of \"service\"). E.g., \"elasticsearch\", \"a_custom_microservice\", \"memcache\"\n */\nexports.PEER_SERVICE = 'peer.service';\n/** PEER_HOSTNAME (string) Remote hostname. E.g., \"opentracing.io\", \"internal.dns.name\" */\nexports.PEER_HOSTNAME = 'peer.hostname';\n/**\n * PEER_ADDRESS (string) Remote \"address\", suitable for use in a\n * networking client library. This may be a \"ip:port\", a bare\n * \"hostname\", a FQDN, or even a JDBC substring like \"mysql://prod-db:3306\"\n */\nexports.PEER_ADDRESS = 'peer.address';\n/**\n * PEER_HOST_IPV4 (number) Remote IPv4 address as a .-separated tuple.\n * E.g., \"127.0.0.1\"\n */\nexports.PEER_HOST_IPV4 = 'peer.ipv4';\n// PEER_HOST_IPV6 (string) Remote IPv6 address as a string of\n// colon-separated 4-char hex tuples. E.g., \"2001:0db8:85a3:0000:0000:8a2e:0370:7334\"\nexports.PEER_HOST_IPV6 = 'peer.ipv6';\n// PEER_PORT (number) Remote port. E.g., 80\nexports.PEER_PORT = 'peer.port';\n// ---------------------------------------------------------------------------\n// HTTP tags\n// ---------------------------------------------------------------------------\n/**\n * HTTP_URL (string) URL of the request being handled in this segment of the\n * trace, in standard URI format. E.g., \"https://domain.net/path/to?resource=here\"\n */\nexports.HTTP_URL = 'http.url';\n/**\n * HTTP_METHOD (string) HTTP method of the request for the associated Span. E.g.,\n * \"GET\", \"POST\"\n */\nexports.HTTP_METHOD = 'http.method';\n/**\n * HTTP_STATUS_CODE (number) HTTP response status code for the associated Span.\n * E.g., 200, 503, 404\n */\nexports.HTTP_STATUS_CODE = 'http.status_code';\n// -------------------------------------------------------------------------\n// Messaging tags\n// -------------------------------------------------------------------------\n/**\n * MESSAGE_BUS_DESTINATION (string) An address at which messages can be exchanged.\n * E.g. A Kafka record has an associated \"topic name\" that can be extracted\n * by the instrumented producer or consumer and stored using this tag.\n */\nexports.MESSAGE_BUS_DESTINATION = 'message_bus.destination';\n// --------------------------------------------------------------------------\n// Database tags\n// --------------------------------------------------------------------------\n/**\n * DB_INSTANCE (string) Database instance name. E.g., In java, if the\n * jdbc.url=\"jdbc:mysql://127.0.0.1:3306/customers\", the instance name is \"customers\".\n */\nexports.DB_INSTANCE = 'db.instance';\n/**\n * DB_STATEMENT (string) A database statement for the given database type.\n * E.g., for db.type=\"SQL\", \"SELECT * FROM wuser_table\";\n * for db.type=\"redis\", \"SET mykey 'WuValue'\".\n */\nexports.DB_STATEMENT = 'db.statement';\n/**\n * DB_TYPE (string) Database type. For any SQL database, \"sql\". For others,\n * the lower-case database category, e.g. \"cassandra\", \"hbase\", or \"redis\".\n */\nexports.DB_TYPE = 'db.type';\n/**\n * DB_USER (string) Username for accessing database. E.g., \"readonly_user\"\n * or \"reporting_user\"\n */\nexports.DB_USER = 'db.user';\n//# sourceMappingURL=tags.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Constants = require(\"./constants\");\nvar reference_1 = require(\"./reference\");\nvar span_1 = require(\"./span\");\n/**\n * Return a new REFERENCE_CHILD_OF reference.\n *\n * @param {SpanContext} spanContext - the parent SpanContext instance to\n *        reference.\n * @return a REFERENCE_CHILD_OF reference pointing to `spanContext`\n */\nfunction childOf(spanContext) {\n    // Allow the user to pass a Span instead of a SpanContext\n    if (spanContext instanceof span_1.default) {\n        spanContext = spanContext.context();\n    }\n    return new reference_1.default(Constants.REFERENCE_CHILD_OF, spanContext);\n}\nexports.childOf = childOf;\n/**\n * Return a new REFERENCE_FOLLOWS_FROM reference.\n *\n * @param {SpanContext} spanContext - the parent SpanContext instance to\n *        reference.\n * @return a REFERENCE_FOLLOWS_FROM reference pointing to `spanContext`\n */\nfunction followsFrom(spanContext) {\n    // Allow the user to pass a Span instead of a SpanContext\n    if (spanContext instanceof span_1.default) {\n        spanContext = spanContext.context();\n    }\n    return new reference_1.default(Constants.REFERENCE_FOLLOWS_FROM, spanContext);\n}\nexports.followsFrom = followsFrom;\n//# sourceMappingURL=functions.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tracer_1 = require(\"./tracer\");\nvar noopTracer = new tracer_1.default();\nvar _globalTracer = null;\n// Allows direct importing/requiring of the global tracer:\n//\n// let globalTracer = require('opentracing/global');\n//      OR\n// import globalTracer from 'opentracing/global';\n//\n// Acts a bridge to the global tracer that can be safely called before the\n// global tracer is initialized. The purpose of the delegation is to avoid the\n// sometimes nearly intractible initialization order problems that can arise in\n// applications with a complex set of dependencies, while also avoiding the\n// case where\nvar GlobalTracerDelegate = /** @class */ (function (_super) {\n    __extends(GlobalTracerDelegate, _super);\n    function GlobalTracerDelegate() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    GlobalTracerDelegate.prototype.startSpan = function () {\n        var tracer = _globalTracer || noopTracer;\n        return tracer.startSpan.apply(tracer, arguments);\n    };\n    GlobalTracerDelegate.prototype.inject = function () {\n        var tracer = _globalTracer || noopTracer;\n        return tracer.inject.apply(tracer, arguments);\n    };\n    GlobalTracerDelegate.prototype.extract = function () {\n        var tracer = _globalTracer || noopTracer;\n        return tracer.extract.apply(tracer, arguments);\n    };\n    return GlobalTracerDelegate;\n}(tracer_1.default));\nvar globalTracerDelegate = new GlobalTracerDelegate();\n/**\n * Set the global Tracer.\n *\n * The behavior is undefined if this function is called more than once.\n *\n * @param {Tracer} tracer - the Tracer implementation\n */\nfunction initGlobalTracer(tracer) {\n    _globalTracer = tracer;\n}\nexports.initGlobalTracer = initGlobalTracer;\n/**\n * Returns the global tracer.\n */\nfunction globalTracer() {\n    // Return the delegate.  Since the global tracer is largely a convenience\n    // (the user can always create their own tracers), the delegate is used to\n    // give the added convenience of not needing to worry about initialization\n    // order.\n    return globalTracerDelegate;\n}\nexports.globalTracer = globalTracer;\n//# sourceMappingURL=global_tracer.js.map","\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar binary_carrier_1 = require(\"./binary_carrier\");\nexports.BinaryCarrier = binary_carrier_1.default;\nvar Tags = require(\"./ext/tags\");\nexports.Tags = Tags;\nvar Noop = require(\"./noop\");\nvar reference_1 = require(\"./reference\");\nexports.Reference = reference_1.default;\nvar span_1 = require(\"./span\");\nexports.Span = span_1.default;\nvar span_context_1 = require(\"./span_context\");\nexports.SpanContext = span_context_1.default;\nvar tracer_1 = require(\"./tracer\");\nexports.Tracer = tracer_1.Tracer;\nvar mock_tracer_1 = require(\"./mock_tracer\");\nexports.MockTracer = mock_tracer_1.MockTracer;\n__export(require(\"./global_tracer\"));\n__export(require(\"./constants\"));\n__export(require(\"./functions\"));\n// Initialize the noops last to avoid a dependecy cycle between the classes.\nNoop.initialize();\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar mock_context_1 = require(\"./mock_context\");\nexports.MockContext = mock_context_1.default;\nvar mock_span_1 = require(\"./mock_span\");\nexports.MockSpan = mock_span_1.default;\nvar mock_tracer_1 = require(\"./mock_tracer\");\nexports.MockTracer = mock_tracer_1.default;\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar opentracing = require(\"../index\");\n/**\n * OpenTracing Context implementation designed for use in\n * unit tests.\n */\nvar MockContext = /** @class */ (function (_super) {\n    __extends(MockContext, _super);\n    function MockContext(span) {\n        var _this = _super.call(this) || this;\n        // Store a reference to the span itself since this is a mock tracer\n        // intended to make debugging and unit testing easier.\n        _this._span = span;\n        return _this;\n    }\n    MockContext.prototype.span = function () {\n        return this._span;\n    };\n    return MockContext;\n}(opentracing.SpanContext));\nexports.MockContext = MockContext;\nexports.default = MockContext;\n//# sourceMappingURL=mock_context.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Index a collection of reported MockSpans in a way that's easy to run unit\n * test assertions against.\n */\nvar MockReport = /** @class */ (function () {\n    function MockReport(spans) {\n        var _this = this;\n        this.spans = spans;\n        this.spansByUUID = {};\n        this.spansByTag = {};\n        this.debugSpans = [];\n        this.unfinishedSpans = [];\n        spans.forEach(function (span) {\n            if (span._finishMs === 0) {\n                _this.unfinishedSpans.push(span);\n            }\n            _this.spansByUUID[span.uuid()] = span;\n            _this.debugSpans.push(span.debug());\n            var tags = span.tags();\n            Object.keys(tags).forEach(function (key) {\n                var val = tags[key];\n                _this.spansByTag[key] = _this.spansByTag[key] || {};\n                _this.spansByTag[key][val] = _this.spansByTag[key][val] || [];\n                _this.spansByTag[key][val].push(span);\n            });\n        });\n    }\n    MockReport.prototype.firstSpanWithTagValue = function (key, val) {\n        var m = this.spansByTag[key];\n        if (!m) {\n            return null;\n        }\n        var n = m[val];\n        if (!n) {\n            return null;\n        }\n        return n[0];\n    };\n    return MockReport;\n}());\nexports.MockReport = MockReport;\nexports.default = MockReport;\n//# sourceMappingURL=mock_report.js.map","\"use strict\";\n/* eslint-disable import/no-extraneous-dependencies */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar opentracing = require(\"../index\");\nvar mock_context_1 = require(\"./mock_context\");\n/**\n * OpenTracing Span implementation designed for use in unit tests.\n */\nvar MockSpan = /** @class */ (function (_super) {\n    __extends(MockSpan, _super);\n    //------------------------------------------------------------------------//\n    // MockSpan-specific\n    //------------------------------------------------------------------------//\n    function MockSpan(tracer) {\n        var _this = _super.call(this) || this;\n        _this._mockTracer = tracer;\n        _this._uuid = _this._generateUUID();\n        _this._startMs = Date.now();\n        _this._finishMs = 0;\n        _this._operationName = '';\n        _this._tags = {};\n        _this._logs = [];\n        return _this;\n    }\n    //------------------------------------------------------------------------//\n    // OpenTracing implementation\n    //------------------------------------------------------------------------//\n    MockSpan.prototype._context = function () {\n        return new mock_context_1.default(this);\n    };\n    MockSpan.prototype._setOperationName = function (name) {\n        this._operationName = name;\n    };\n    MockSpan.prototype._addTags = function (set) {\n        var keys = Object.keys(set);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var key = keys_1[_i];\n            this._tags[key] = set[key];\n        }\n    };\n    MockSpan.prototype._log = function (fields, timestamp) {\n        this._logs.push({\n            fields: fields,\n            timestamp: timestamp\n        });\n    };\n    MockSpan.prototype._finish = function (finishTime) {\n        this._finishMs = finishTime || Date.now();\n    };\n    MockSpan.prototype.uuid = function () {\n        return this._uuid;\n    };\n    MockSpan.prototype.operationName = function () {\n        return this._operationName;\n    };\n    MockSpan.prototype.durationMs = function () {\n        return this._finishMs - this._startMs;\n    };\n    MockSpan.prototype.tags = function () {\n        return this._tags;\n    };\n    MockSpan.prototype.tracer = function () {\n        return this._mockTracer;\n    };\n    MockSpan.prototype._generateUUID = function () {\n        var p0 = (\"00000000\" + Math.abs((Math.random() * 0xFFFFFFFF) | 0).toString(16)).substr(-8);\n        var p1 = (\"00000000\" + Math.abs((Math.random() * 0xFFFFFFFF) | 0).toString(16)).substr(-8);\n        return \"\" + p0 + p1;\n    };\n    MockSpan.prototype.addReference = function (ref) {\n    };\n    /**\n     * Returns a simplified object better for console.log()'ing.\n     */\n    MockSpan.prototype.debug = function () {\n        var obj = {\n            uuid: this._uuid,\n            operation: this._operationName,\n            millis: [this._finishMs - this._startMs, this._startMs, this._finishMs]\n        };\n        if (Object.keys(this._tags).length) {\n            obj.tags = this._tags;\n        }\n        return obj;\n    };\n    return MockSpan;\n}(opentracing.Span));\nexports.MockSpan = MockSpan;\nexports.default = MockSpan;\n//# sourceMappingURL=mock_span.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// TODO: Move mock-tracer to its own NPM package once it is complete and tested.\nvar opentracing = require(\"../index\");\nvar mock_report_1 = require(\"./mock_report\");\nvar mock_span_1 = require(\"./mock_span\");\n/**\n * OpenTracing Tracer implementation designed for use in unit tests.\n */\nvar MockTracer = /** @class */ (function (_super) {\n    __extends(MockTracer, _super);\n    //------------------------------------------------------------------------//\n    // MockTracer-specific\n    //------------------------------------------------------------------------//\n    function MockTracer() {\n        var _this = _super.call(this) || this;\n        _this._spans = [];\n        return _this;\n    }\n    //------------------------------------------------------------------------//\n    // OpenTracing implementation\n    //------------------------------------------------------------------------//\n    MockTracer.prototype._startSpan = function (name, fields) {\n        // _allocSpan is given it's own method so that derived classes can\n        // allocate any type of object they want, but not have to duplicate\n        // the other common logic in startSpan().\n        var span = this._allocSpan();\n        span.setOperationName(name);\n        this._spans.push(span);\n        if (fields.references) {\n            for (var _i = 0, _a = fields.references; _i < _a.length; _i++) {\n                var ref = _a[_i];\n                span.addReference(ref);\n            }\n        }\n        // Capture the stack at the time the span started\n        span._startStack = new Error().stack;\n        return span;\n    };\n    MockTracer.prototype._inject = function (span, format, carrier) {\n        throw new Error('NOT YET IMPLEMENTED');\n    };\n    MockTracer.prototype._extract = function (format, carrier) {\n        throw new Error('NOT YET IMPLEMENTED');\n    };\n    MockTracer.prototype._allocSpan = function () {\n        return new mock_span_1.default(this);\n    };\n    /**\n     * Discard any buffered data.\n     */\n    MockTracer.prototype.clear = function () {\n        this._spans = [];\n    };\n    /**\n     * Return the buffered data in a format convenient for making unit test\n     * assertions.\n     */\n    MockTracer.prototype.report = function () {\n        return new mock_report_1.default(this._spans);\n    };\n    return MockTracer;\n}(opentracing.Tracer));\nexports.MockTracer = MockTracer;\nexports.default = MockTracer;\n//# sourceMappingURL=mock_tracer.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar span_1 = require(\"./span\");\nvar span_context_1 = require(\"./span_context\");\nvar tracer_1 = require(\"./tracer\");\nexports.tracer = null;\nexports.spanContext = null;\nexports.span = null;\n// Deferred initialization to avoid a dependency cycle where Tracer depends on\n// Span which depends on the noop tracer.\nfunction initialize() {\n    exports.tracer = new tracer_1.default();\n    exports.span = new span_1.default();\n    exports.spanContext = new span_context_1.default();\n}\nexports.initialize = initialize;\n//# sourceMappingURL=noop.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar span_1 = require(\"./span\");\n/**\n * Reference pairs a reference type constant (e.g., REFERENCE_CHILD_OF or\n * REFERENCE_FOLLOWS_FROM) with the SpanContext it points to.\n *\n * See the exported childOf() and followsFrom() functions at the package level.\n */\nvar Reference = /** @class */ (function () {\n    /**\n     * Initialize a new Reference instance.\n     *\n     * @param {string} type - the Reference type constant (e.g.,\n     *        REFERENCE_CHILD_OF or REFERENCE_FOLLOWS_FROM).\n     * @param {SpanContext} referencedContext - the SpanContext being referred\n     *        to. As a convenience, a Span instance may be passed in instead\n     *        (in which case its .context() is used here).\n     */\n    function Reference(type, referencedContext) {\n        this._type = type;\n        this._referencedContext = (referencedContext instanceof span_1.default ?\n            referencedContext.context() :\n            referencedContext);\n    }\n    /**\n     * @return {string} The Reference type (e.g., REFERENCE_CHILD_OF or\n     *         REFERENCE_FOLLOWS_FROM).\n     */\n    Reference.prototype.type = function () {\n        return this._type;\n    };\n    /**\n     * @return {SpanContext} The SpanContext being referred to (e.g., the\n     *         parent in a REFERENCE_CHILD_OF Reference).\n     */\n    Reference.prototype.referencedContext = function () {\n        return this._referencedContext;\n    };\n    return Reference;\n}());\nexports.default = Reference;\n//# sourceMappingURL=reference.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar noop = require(\"./noop\");\n/**\n * Span represents a logical unit of work as part of a broader Trace. Examples\n * of span might include remote procedure calls or a in-process function calls\n * to sub-components. A Trace has a single, top-level \"root\" Span that in turn\n * may have zero or more child Spans, which in turn may have children.\n */\nvar Span = /** @class */ (function () {\n    function Span() {\n    }\n    // ---------------------------------------------------------------------- //\n    // OpenTracing API methods\n    // ---------------------------------------------------------------------- //\n    /**\n     * Returns the SpanContext object associated with this Span.\n     *\n     * @return {SpanContext}\n     */\n    Span.prototype.context = function () {\n        return this._context();\n    };\n    /**\n     * Returns the Tracer object used to create this Span.\n     *\n     * @return {Tracer}\n     */\n    Span.prototype.tracer = function () {\n        return this._tracer();\n    };\n    /**\n     * Sets the string name for the logical operation this span represents.\n     *\n     * @param {string} name\n     */\n    Span.prototype.setOperationName = function (name) {\n        this._setOperationName(name);\n        return this;\n    };\n    /**\n     * Sets a key:value pair on this Span that also propagates to future\n     * children of the associated Span.\n     *\n     * setBaggageItem() enables powerful functionality given a full-stack\n     * opentracing integration (e.g., arbitrary application data from a web\n     * client can make it, transparently, all the way into the depths of a\n     * storage system), and with it some powerful costs: use this feature with\n     * care.\n     *\n     * IMPORTANT NOTE #1: setBaggageItem() will only propagate baggage items to\n     * *future* causal descendants of the associated Span.\n     *\n     * IMPORTANT NOTE #2: Use this thoughtfully and with care. Every key and\n     * value is copied into every local *and remote* child of the associated\n     * Span, and that can add up to a lot of network and cpu overhead.\n     *\n     * @param {string} key\n     * @param {string} value\n     */\n    Span.prototype.setBaggageItem = function (key, value) {\n        this._setBaggageItem(key, value);\n        return this;\n    };\n    /**\n     * Returns the value for a baggage item given its key.\n     *\n     * @param  {string} key\n     *         The key for the given trace attribute.\n     * @return {string}\n     *         String value for the given key, or undefined if the key does not\n     *         correspond to a set trace attribute.\n     */\n    Span.prototype.getBaggageItem = function (key) {\n        return this._getBaggageItem(key);\n    };\n    /**\n     * Adds a single tag to the span.  See `addTags()` for details.\n     *\n     * @param {string} key\n     * @param {any} value\n     */\n    Span.prototype.setTag = function (key, value) {\n        // NOTE: the call is normalized to a call to _addTags()\n        this._addTags((_a = {}, _a[key] = value, _a));\n        return this;\n        var _a;\n    };\n    /**\n     * Adds the given key value pairs to the set of span tags.\n     *\n     * Multiple calls to addTags() results in the tags being the superset of\n     * all calls.\n     *\n     * The behavior of setting the same key multiple times on the same span\n     * is undefined.\n     *\n     * The supported type of the values is implementation-dependent.\n     * Implementations are expected to safely handle all types of values but\n     * may choose to ignore unrecognized / unhandle-able values (e.g. objects\n     * with cyclic references, function objects).\n     *\n     * @return {[type]} [description]\n     */\n    Span.prototype.addTags = function (keyValueMap) {\n        this._addTags(keyValueMap);\n        return this;\n    };\n    /**\n     * Add a log record to this Span, optionally at a user-provided timestamp.\n     *\n     * For example:\n     *\n     *     span.log({\n     *         size: rpc.size(),  // numeric value\n     *         URI: rpc.URI(),  // string value\n     *         payload: rpc.payload(),  // Object value\n     *         \"keys can be arbitrary strings\": rpc.foo(),\n     *     });\n     *\n     *     span.log({\n     *         \"error.description\": someError.description(),\n     *     }, someError.timestampMillis());\n     *\n     * @param {object} keyValuePairs\n     *        An object mapping string keys to arbitrary value types. All\n     *        Tracer implementations should support bool, string, and numeric\n     *        value types, and some may also support Object values.\n     * @param {number} timestamp\n     *        An optional parameter specifying the timestamp in milliseconds\n     *        since the Unix epoch. Fractional values are allowed so that\n     *        timestamps with sub-millisecond accuracy can be represented. If\n     *        not specified, the implementation is expected to use its notion\n     *        of the current time of the call.\n     */\n    Span.prototype.log = function (keyValuePairs, timestamp) {\n        this._log(keyValuePairs, timestamp);\n        return this;\n    };\n    /**\n     * DEPRECATED\n     */\n    Span.prototype.logEvent = function (eventName, payload) {\n        return this._log({ event: eventName, payload: payload });\n    };\n    /**\n     * Sets the end timestamp and finalizes Span state.\n     *\n     * With the exception of calls to Span.context() (which are always allowed),\n     * finish() must be the last call made to any span instance, and to do\n     * otherwise leads to undefined behavior.\n     *\n     * @param  {number} finishTime\n     *         Optional finish time in milliseconds as a Unix timestamp. Decimal\n     *         values are supported for timestamps with sub-millisecond accuracy.\n     *         If not specified, the current time (as defined by the\n     *         implementation) will be used.\n     */\n    Span.prototype.finish = function (finishTime) {\n        this._finish(finishTime);\n        // Do not return `this`. The Span generally should not be used after it\n        // is finished so chaining is not desired in this context.\n    };\n    // ---------------------------------------------------------------------- //\n    // Derived classes can choose to implement the below\n    // ---------------------------------------------------------------------- //\n    // By default returns a no-op SpanContext.\n    Span.prototype._context = function () {\n        return noop.spanContext;\n    };\n    // By default returns a no-op tracer.\n    //\n    // The base class could store the tracer that created it, but it does not\n    // in order to ensure the no-op span implementation has zero members,\n    // which allows V8 to aggressively optimize calls to such objects.\n    Span.prototype._tracer = function () {\n        return noop.tracer;\n    };\n    // By default does nothing\n    Span.prototype._setOperationName = function (name) {\n    };\n    // By default does nothing\n    Span.prototype._setBaggageItem = function (key, value) {\n    };\n    // By default does nothing\n    Span.prototype._getBaggageItem = function (key) {\n        return undefined;\n    };\n    // By default does nothing\n    //\n    // NOTE: both setTag() and addTags() map to this function. keyValuePairs\n    // will always be an associative array.\n    Span.prototype._addTags = function (keyValuePairs) {\n    };\n    // By default does nothing\n    Span.prototype._log = function (keyValuePairs, timestamp) {\n    };\n    // By default does nothing\n    //\n    // finishTime is expected to be either a number or undefined.\n    Span.prototype._finish = function (finishTime) {\n    };\n    return Span;\n}());\nexports.Span = Span;\nexports.default = Span;\n//# sourceMappingURL=span.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * SpanContext represents Span state that must propagate to descendant Spans\n * and across process boundaries.\n *\n * SpanContext is logically divided into two pieces: the user-level \"Baggage\"\n * (see setBaggageItem and getBaggageItem) that propagates across Span\n * boundaries and any Tracer-implementation-specific fields that are needed to\n * identify or otherwise contextualize the associated Span instance (e.g., a\n * <trace_id, span_id, sampled> tuple).\n */\nvar SpanContext = /** @class */ (function () {\n    function SpanContext() {\n    }\n    return SpanContext;\n}());\nexports.SpanContext = SpanContext;\nexports.default = SpanContext;\n//# sourceMappingURL=span_context.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Functions = require(\"./functions\");\nvar Noop = require(\"./noop\");\nvar span_1 = require(\"./span\");\n/**\n * Tracer is the entry-point between the instrumentation API and the tracing\n * implementation.\n *\n * The default object acts as a no-op implementation.\n *\n * Note to implementators: derived classes can choose to directly implement the\n * methods in the \"OpenTracing API methods\" section, or optionally the subset of\n * underscore-prefixed methods to pick up the argument checking and handling\n * automatically from the base class.\n */\nvar Tracer = /** @class */ (function () {\n    function Tracer() {\n    }\n    // ---------------------------------------------------------------------- //\n    // OpenTracing API methods\n    // ---------------------------------------------------------------------- //\n    /**\n     * Starts and returns a new Span representing a logical unit of work.\n     *\n     * For example:\n     *\n     *     // Start a new (parentless) root Span:\n     *     var parent = Tracer.startSpan('DoWork');\n     *\n     *     // Start a new (child) Span:\n     *     var child = Tracer.startSpan('load-from-db', {\n     *         childOf: parent.context(),\n     *     });\n     *\n     *     // Start a new async (FollowsFrom) Span:\n     *     var child = Tracer.startSpan('async-cache-write', {\n     *         references: [\n     *             opentracing.followsFrom(parent.context())\n     *         ],\n     *     });\n     *\n     * @param {string} name - the name of the operation (REQUIRED).\n     * @param {SpanOptions} [options] - options for the newly created span.\n     * @return {Span} - a new Span object.\n     */\n    Tracer.prototype.startSpan = function (name, options) {\n        if (options === void 0) { options = {}; }\n        // Convert options.childOf to fields.references as needed.\n        if (options.childOf) {\n            // Convert from a Span or a SpanContext into a Reference.\n            var childOf = Functions.childOf(options.childOf);\n            if (options.references) {\n                options.references.push(childOf);\n            }\n            else {\n                options.references = [childOf];\n            }\n            delete (options.childOf);\n        }\n        return this._startSpan(name, options);\n    };\n    /**\n     * Injects the given SpanContext instance for cross-process propagation\n     * within `carrier`. The expected type of `carrier` depends on the value of\n     * `format.\n     *\n     * OpenTracing defines a common set of `format` values (see\n     * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has\n     * an expected carrier type.\n     *\n     * Consider this pseudocode example:\n     *\n     *     var clientSpan = ...;\n     *     ...\n     *     // Inject clientSpan into a text carrier.\n     *     var headersCarrier = {};\n     *     Tracer.inject(clientSpan.context(), Tracer.FORMAT_HTTP_HEADERS, headersCarrier);\n     *     // Incorporate the textCarrier into the outbound HTTP request header\n     *     // map.\n     *     Object.assign(outboundHTTPReq.headers, headersCarrier);\n     *     // ... send the httpReq\n     *\n     * @param  {SpanContext} spanContext - the SpanContext to inject into the\n     *         carrier object. As a convenience, a Span instance may be passed\n     *         in instead (in which case its .context() is used for the\n     *         inject()).\n     * @param  {string} format - the format of the carrier.\n     * @param  {any} carrier - see the documentation for the chosen `format`\n     *         for a description of the carrier object.\n     */\n    Tracer.prototype.inject = function (spanContext, format, carrier) {\n        // Allow the user to pass a Span instead of a SpanContext\n        if (spanContext instanceof span_1.default) {\n            spanContext = spanContext.context();\n        }\n        return this._inject(spanContext, format, carrier);\n    };\n    /**\n     * Returns a SpanContext instance extracted from `carrier` in the given\n     * `format`.\n     *\n     * OpenTracing defines a common set of `format` values (see\n     * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has\n     * an expected carrier type.\n     *\n     * Consider this pseudocode example:\n     *\n     *     // Use the inbound HTTP request's headers as a text map carrier.\n     *     var headersCarrier = inboundHTTPReq.headers;\n     *     var wireCtx = Tracer.extract(Tracer.FORMAT_HTTP_HEADERS, headersCarrier);\n     *     var serverSpan = Tracer.startSpan('...', { childOf : wireCtx });\n     *\n     * @param  {string} format - the format of the carrier.\n     * @param  {any} carrier - the type of the carrier object is determined by\n     *         the format.\n     * @return {SpanContext}\n     *         The extracted SpanContext, or null if no such SpanContext could\n     *         be found in `carrier`\n     */\n    Tracer.prototype.extract = function (format, carrier) {\n        return this._extract(format, carrier);\n    };\n    // ---------------------------------------------------------------------- //\n    // Derived classes can choose to implement the below\n    // ---------------------------------------------------------------------- //\n    // NOTE: the input to this method is *always* an associative array. The\n    // public-facing startSpan() method normalizes the arguments so that\n    // all N implementations do not need to worry about variations in the call\n    // signature.\n    //\n    // The default behavior returns a no-op span.\n    Tracer.prototype._startSpan = function (name, fields) {\n        return Noop.span;\n    };\n    // The default behavior is a no-op.\n    Tracer.prototype._inject = function (spanContext, format, carrier) {\n    };\n    // The default behavior is to return a no-op SpanContext.\n    Tracer.prototype._extract = function (format, carrier) {\n        return Noop.spanContext;\n    };\n    return Tracer;\n}());\nexports.Tracer = Tracer;\nexports.default = Tracer;\n//# sourceMappingURL=tracer.js.map","// Underscore.js-like wrapper to iterate object key-values. Note that even for completely\n// internal objects, packages may modify default Object prototypes and properties\n// (e.g. Ember.js) so it's almost never safe to assume a particular object can\n// iterated with for-in.\nexport default function _each(obj, cb) {\n    if (!obj) {\n        return;\n    }\n    for (let key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            cb(obj[key], key);\n        }\n    }\n}\n","\nexport const LOG_INFO = 0;\nexport const LOG_WARN = 1;\nexport const LOG_ERROR = 2;\nexport const LOG_FATAL = 3;\n\nexport const LOG_LEVEL_TO_STRING = {\n    LOG_INFO  : 'I',\n    LOG_WARN  : 'W',\n    LOG_ERROR : 'E',\n    LOG_FATAL : 'F',\n};\nexport const LOG_STRING_TO_LEVEL = {\n    I : LOG_INFO,\n    W : LOG_WARN,\n    E : LOG_ERROR,\n    F : LOG_FATAL,\n};\n\n// The report interval for empty reports used to sample the clock skew\nexport const CLOCK_STATE_REFRESH_INTERVAL_MS = 350;\n\nexport const SPLUNK_APP_URL_PREFIX = 'https://app.splunk.com';\n\nexport const JOIN_ID_PREFIX = 'join:';\n\nexport const SPL_META_EVENT_KEY = 'splunk.meta_event';\nexport const SPL_META_PROPAGATION_KEY = 'splunk.propagation_format';\nexport const SPL_META_TRACE_KEY = 'splunk.trace_id';\nexport const SPL_META_SPAN_KEY = 'splunk.span_id';\nexport const SPL_META_TRACER_GUID_KEY = 'splunk.tracer_guid';\nexport const SPL_META_EXTRACT = 'splunk.extract_span';\nexport const SPL_META_INJECT = 'splunk.inject_span';\nexport const SPL_META_SP_START = 'splunk.span_start';\nexport const SPL_META_SP_FINISH = 'splunk.span_finish';\nexport const SPL_META_TRACER_CREATE = 'splunk.tracer_create';\n","\nexport default class AuthImp {\n    constructor(accessToken) {\n        this._accessToken = accessToken;\n    }\n\n    getAccessToken() {\n        if (typeof this._accessToken === 'undefined' || this._accessToken === null || this._accessToken.length === 0) {\n            return 'empty';\n        }\n\n        return this._accessToken;\n    }\n}\n","\nexport function toString(value) {\n    return '' + value;  // eslint-disable-line prefer-template\n}\n\nexport function toNumber(value) {\n    return Number(value);\n}\n\nexport function toBoolean(value) {\n    return !!value;\n}\n","import _each from '../_each';\n\nclass PackageGlobals {\n    constructor() {\n        this.options = {};\n    }\n\n    setOptions(opts) {\n        _each(opts, (val, key) => {\n            this.options[key] = val;\n        });\n    }\n}\n\nmodule.exports = new PackageGlobals();\n","const constants = require('../constants');\nconst coerce    = require('./coerce');\n\n// Facade on the thrift log data structure to make constructing log records more\n// convenient.\nclass LogBuilder {\n\n    constructor(runtime) {\n        this._runtime = runtime;\n        this._record = {\n            timestamp_micros : runtime._platform.nowMicros(),\n            runtime_guid     : null,\n            span_guid        : null,\n            stable_name      : null,\n            message          : null,\n            level            : null,\n            thread_id        : null,\n            filename         : null,\n            line_number      : null,\n            stack_frames     : null,\n            payload_json     : null,\n            error_flag       : null,\n        };\n    }\n\n    record() {\n        return this._record;\n    }\n\n    end() {\n        this._runtime._addLogRecord(this._record);\n    }\n\n    timestamp(micros) {\n        this._record.timestamp_micros = coerce.toNumber(micros);\n        return this;\n    }\n\n    message(msg) {\n        this._record.message = coerce.toString(msg);\n        return this;\n    }\n\n    level(num) {\n        this._record.level = constants.LOG_LEVEL_TO_STRING[num] || null;\n        if (num >= constants.LOG_ERROR) {\n            this.error(true);\n        }\n        return this;\n    }\n\n    span(guid) {\n        if (guid !== undefined) {\n            this._record.span_guid = coerce.toString(guid);\n        }\n        return this;\n    }\n\n    name(stableName) {\n        this._record.stable_name = coerce.toString(stableName);\n        return this;\n    }\n\n    error(flag) {\n        this._record.error_flag = coerce.toBoolean(flag);\n        return this;\n    }\n\n    payload(data) {\n        if (data !== undefined) {\n            this._record.payload_json = this._encodePayload(data);\n        }\n        return this;\n    }\n\n    _encodePayload(data) {\n        let payloadJSON = null;\n        try {\n            payloadJSON = JSON.stringify(data);\n        } catch (_ignored) {\n            // TODO: this should log an internal warning that a payload could\n            // not be encoded as JSON.\n            return undefined;\n        }\n        return payloadJSON;\n    }\n}\n\nmodule.exports = LogBuilder;\n","import _each from '../_each';\nimport * as coerce from './coerce'; // eslint-disable-line camelcase\n\nexport default class LogRecordImp {\n    constructor(logFieldKeyHardLimit, logFieldValueHardLimit, timestampMicros, fields) {\n        if (fields instanceof Error) {\n            fields = {\n                stack   : fields.stack,\n                message : fields.message,\n            };\n        }\n\n        this._logFieldKeyHardLimit = logFieldKeyHardLimit;\n        this._logFieldValueHardLimit = logFieldValueHardLimit;\n        this._timestampMicros = timestampMicros;\n        this._fields = fields;\n        this._keysOverLimit = 0;\n        this._valuesOverLimit = 0;\n    }\n\n    _clearOverLimits() {\n        this._keysOverLimit = 0;\n        this._valuesOverLimit = 0;\n    }\n\n    getNumKeysOverLimit() {\n        return this._keysOverLimit;\n    }\n\n    getNumValuesOverLimit() {\n        return this._valuesOverLimit;\n    }\n\n    toThrift() {\n        this._clearOverLimits();\n        let thriftFields = [];\n        _each(this._fields, (value, key) => {\n            if (!key || !value) {\n                return;\n            }\n            let keyStr = this.getFieldKey(key);\n            let valStr = this.getFieldValue(value);\n            thriftFields.push(new crouton_thrift.KeyValue({\n                Key   : keyStr,\n                Value : valStr,\n            }));\n        });\n\n        return new crouton_thrift.LogRecord({\n            timestamp_micros : this._timestampMicros,\n            fields           : thriftFields,\n        });\n    }\n\n    getFieldKey(key) {\n        let keyStr = coerce.toString(key);\n        if (keyStr.length > this._logFieldKeyHardLimit) {\n            this._keysOverLimit += 1;\n            keyStr = `${keyStr.substr(0, this._logFieldKeyHardLimit)}...`;\n        }\n        return keyStr;\n    }\n\n    getFieldValue(value) {\n        let valStr = null;\n        if (value instanceof Error) {\n            try {\n                // https://stackoverflow.com/a/26199752/9778850\n                valStr = JSON.stringify(value, Object.getOwnPropertyNames(value));\n            } catch (e) {\n                valStr = `Could not encode value. Exception: ${e}`;\n            }\n        } else if (value instanceof Object) {\n            try {\n                valStr = JSON.stringify(value, null, '  ');\n            } catch (e) {\n                valStr = `Could not encode value. Exception: ${e}`;\n            }\n        } else {\n            valStr = coerce.toString(value);\n        }\n        if (valStr.length > this._logFieldValueHardLimit) {\n            this._valuesOverLimit += 1;\n            valStr = `${valStr.substr(0, this._logFieldValueHardLimit)}...`;\n        }\n        return valStr;\n    }\n\n    toProto() {\n        this._clearOverLimits();\n        let log = new proto.Log();\n        let ts = new googleProtobufTimestampPB.Timestamp();\n        let millis = Math.floor(this._timestampMicros / 1000);\n        let secs = Math.floor(millis / 1000);\n        let nanos = (millis % 1000) * 1000000;\n        ts.setSeconds(secs);\n        ts.setNanos(nanos);\n        log.setTimestamp(ts);\n        let keyValues = [];\n        _each(this._fields, (value, key) => {\n            if (!key || !value) {\n                return;\n            }\n            let keyStr = this.getFieldKey(key);\n            let valStr = this.getFieldValue(value);\n\n            let keyValue = new proto.KeyValue();\n            keyValue.setKey(keyStr);\n            keyValue.setStringValue(valStr);\n            keyValues.push(keyValue);\n        });\n\n        log.setFieldsList(keyValues);\n\n        return log;\n    }\n}\n","/* global WorkerGlobalScope */\n// Find the HTML element that included the tracing library (if there is one).\n// This relies on the fact that scripts are executed as soon as they are\n// included -- thus 'this' script is the last one in the array at the time\n// this is run.\nlet hostScriptElement = (function () {\n    // check to see if we're in a webworker\n    if (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope) {\n        return null;\n    }\n    let scripts = document.getElementsByTagName('SCRIPT');\n    if (!(scripts.length > 0)) {\n        return null;\n    }\n    return scripts[scripts.length - 1];\n}());\n\nfunction urlQueryParameters(defaults) {\n    let vars = {};\n    let qi = window.location.href.indexOf('?');\n    if (qi < 0) {\n        return vars;\n    }\n    let slice = window.location.href.slice(qi + 1);\n    if (slice.indexOf('#') >= 0) {\n        slice = slice.slice(0, slice.indexOf('#'));\n    }\n    let hashes = slice.replace(/\\+/, '%20').split('&');\n    for (let i = 0; i < hashes.length; i++) {\n        let hash = hashes[i].split('=');\n        vars[decodeURIComponent(hash[0])] = decodeURIComponent(hash[1]);\n    }\n    return vars;\n}\n\n// Parses options out of the host <script> element. Allows for easy configuration\n// via the HTML element. Example:\n//\n// <script src='splunk-tracing.min.js'\n//      data-access_token='{my_access_token}'\n//      data-component_name='my_component'></script>\n//\n// Note: relies on the global hostScriptElement variable defined above.\n//\nmodule.exports.parseScriptElementOptions = function (opts, browserOpts) {\n    if (!hostScriptElement) {\n        return;\n    }\n\n    let dataset = hostScriptElement.dataset;\n\n    let accessToken = dataset.access_token;\n    if (typeof accessToken === 'string' && accessToken.length > 0) {\n        opts.access_token = accessToken;\n    }\n\n    let componentName = dataset.component_name;\n    if (typeof componentName === 'string' && componentName.length > 0) {\n        opts.component_name = componentName;\n    }\n\n    let collectorHost = dataset.collector_host;\n    if (typeof collectorHost === 'string' && collectorHost.length > 0) {\n        opts.collector_host = collectorHost;\n    }\n    let collectorPort = dataset.collector_port;\n    if (collectorPort) {\n        opts.collector_port = parseInt(collectorPort, 10);\n    }\n    let collectorPath = dataset.collector_path;\n    if (typeof collectorPath === 'string' && collectorPath.length > 0) {\n        opts.collector_path = collectorPath;\n    }\n    let collectorEncryption = dataset.collector_encryption;\n    if (collectorEncryption) {\n        opts.collector_encryption = collectorEncryption;\n    }\n\n    let enable = dataset.enable;\n    if (typeof enable === 'string') {\n        if (enable === 'true') {\n            opts.enable = true;\n        } else if (enable === 'false') {\n            opts.enable = false;\n        }\n    }\n    let verbosity = dataset.verbosity;\n    if (typeof verbosity === 'string') {\n        opts.verbosity = parseInt(verbosity, 10);\n    }\n\n    let init = dataset.init_global_tracer;\n    if (typeof init === 'string') {\n        if (init === 'true') {\n            browserOpts.init_global_tracer = true;\n        } else if (init === 'false') {\n            browserOpts.init_global_tracer = false;\n        }\n    }\n\n    // NOTE: this is a little inelegant as this is hard-coding support for a\n    // \"plug-in\" option.\n    if (typeof dataset.xhr_instrumentation === 'string' && dataset.xhr_instrumentation === 'true') {\n        opts.xhr_instrumentation = true;\n    }\n\n    if (typeof dataset.instrument_page_load === 'string' && dataset.instrument_page_load === 'true') {\n        opts.instrument_page_load = true;\n    }\n};\n\n// Parses options out of the current URL query string. The query parameters use\n// the 'splunk_' prefix to reduce the chance of collision with\n// application-specific query parameters.\n//\n// This mechanism is particularly useful for debugging purposes as it does not\n// require any code or configuration changes.\n//\nmodule.exports.parseURLQueryOptions = function (opts) {\n    if (!window) {\n        return;\n    }\n\n    let params = urlQueryParameters();\n    if (params.splunk_verbosity) {\n        try {\n            opts.verbosity = parseInt(params.splunk_verbosity, 10);\n        } catch (_ignored) { /* Ignored */ }\n    }\n    if (params.splunk_log_to_console) {\n        opts.log_to_console = true;\n    }\n};\n","const optionsParser = require('./options_parser.js');\nconst util = require('./util');\n\nconst kRuntimeGUIDCookiePrefix = 'splunk_guid';\nconst kSessionIDCookieKey = 'splunk_session_id';\nconst kCookieTimeToLiveSeconds = 7 * 24 * 60 * 60;\n\nlet nowMicrosImp = (function () {\n    // Is a hi-res timer available?\n    if (window.performance &&\n        window.performance.now &&\n        window.performance.timing &&\n        window.performance.timing.navigationStart) {\n        let start = performance.timing.navigationStart;\n        return function () {\n            return Math.floor((start + performance.now()) * 1000.0);\n        };\n    }\n    // The low-res timer is the best we can do\n    return function () {\n        return Date.now() * 1000.0;\n    };\n}());\n\nclass PlatformBrowser {\n\n    name() {\n        return 'browser';\n    }\n\n    nowMicros() {\n        return nowMicrosImp();\n    }\n\n    // Return the GUID to use for the runtime. The intention is to reuse the\n    // GUID so that logically a single browser session looks like a single\n    // runtime.\n    runtimeGUID(groupName) {\n        // Account for the groupName in the same that multiple apps or services\n        // are running on the same domain (and should not share the same\n        // runtime GUID).\n        let cookieKey = `${kRuntimeGUIDCookiePrefix}/${groupName}`;\n        let uuid = util.cookie(cookieKey) || this._generateLongUUID();\n        util.cookie(cookieKey, uuid, kCookieTimeToLiveSeconds, '/');\n\n        // Also create a session ID as well to give the server more information\n        // to coordinate with.\n        let sessionID = util.cookie(kSessionIDCookieKey) || this._generateLongUUID();\n        util.cookie(kSessionIDCookieKey, sessionID, kCookieTimeToLiveSeconds, '/');\n\n        return uuid;\n    }\n\n    generateUUID() {\n        return this._generateLongUUID();\n    }\n\n    _generateLongUUID() {\n        let p0 = `00000000${Math.abs((Math.random() * 0xFFFFFFFF) | 0).toString(16)}`.substr(-8);\n        let p1 = `00000000${Math.abs((Math.random() * 0xFFFFFFFF) | 0).toString(16)}`.substr(-8);\n        return `${p0}${p1}`;\n    }\n\n    onBeforeExit(...args) {\n        if (window) {\n            window.addEventListener('beforeunload', ...args);\n        }\n    }\n\n    plugins(opts) {\n        return [\n            require('../../../plugins/instrument_xhr'),\n            require('../../../plugins/instrument_fetch'),\n            require('../../../plugins/instrument_document_load'),\n        ];\n    }\n\n    options(imp) {\n        let tracerOpts = {};\n        let browserOpts = {};\n        optionsParser.parseScriptElementOptions(tracerOpts, browserOpts);\n        optionsParser.parseURLQueryOptions(tracerOpts, browserOpts);\n        return tracerOpts;\n    }\n\n    static initLibrary(lib) {\n        let tracerOpts = {};\n        let browserOpts = {};\n        optionsParser.parseScriptElementOptions(tracerOpts, browserOpts);\n\n        if (browserOpts.init_global_tracer) {\n            PlatformBrowser.initGlobalTracer(lib, tracerOpts);\n        }\n    }\n    static initGlobalTracer(lib, opts) {\n        if (typeof window !== 'object') {\n            return;\n        }\n        if (typeof window.opentracing !== 'object') {\n            return;\n        }\n        opentracing.initGlobalTracer(new lib.Tracer(opts));  // eslint-disable-line no-undef\n    }\n\n    tracerTags() {\n        return {\n            'tracer_platform' : 'browser',\n        };\n    }\n\n    // There's no way to truly \"fatal\" on the browser; the best approximation\n    // is an Error exception.\n    fatal(message) {\n        throw new Error(message);\n    }\n\n    localStoreGet(key) {\n        if (!window.sessionStorage) {\n            return null;\n        }\n        try {\n            return JSON.parse(sessionStorage.getItem(`splunk/${key}`));\n        } catch (_ignored) {\n            return null;\n        }\n    }\n\n    localStoreSet(key, value) {\n        if (!window.sessionStorage) {\n            return;\n        }\n        try {\n            sessionStorage.setItem(`splunk/${key}`, JSON.stringify(value));\n        } catch (_ignored) { /* Ignored */ }\n    }\n}\n\nmodule.exports = PlatformBrowser;\n","\nexport default class TransportBrowser {\n\n    constructor() {\n        this._host = '';\n        this._port = 0;\n        this._encryption = '';\n        this._access_token = '';\n    }\n\n    ensureConnection(opts) {\n        this._host = opts.collector_host;\n        this._port = opts.collector_port;\n        this._encryption = opts.collector_encryption;\n        this._access_token = opts.access_token;\n\n    }\n\n    report(detached, auth, report, done) {\n        try {\n            if (!detached) {\n                this._reportAJAX(auth, report, done);\n            }\n        } catch (e) {\n            return done(e, null);\n        }\n    }\n\n    _reportAJAX(auth, report, done) {\n        let reportJSON = report.toJSON(auth);\n        let protocol = (this._encryption === 'none') ? 'http' : 'https';\n        let url = `${protocol}://${this._host}:${this._port}/services/collector`;\n        let xhr = new XMLHttpRequest();\n        xhr.responseType = 'json';\n        xhr.open('POST', url);\n        // Note: the browser automatically sets 'Connection' and 'Content-Length'\n        // and *does not* allow they to be set manually\n        xhr.setRequestHeader('Accept', 'application/json');\n        xhr.setRequestHeader('Authorization', 'Splunk '+ this._access_token);\n        xhr.onreadystatechange = function () {\n            if (this.readyState === 4) {\n                let err = null;\n                let resp = null;\n                if (this.status !== 200) {\n                    err = new Error(`status code = ${this.status}`);\n                } else if (!this.response) {\n                    err = new Error('unexpected empty response');\n                } else {\n                    try {\n                        resp = this.response;\n                    } catch (exception) {\n                        err = exception;\n                    }\n                }\n                return done(err, resp);\n            }\n        };\n        let serialized = reportJSON.join('\\n');\n        xhr.send(serialized);\n    }\n}\n","/* eslint-disable */\n\n// This function is copied directly from https://github.com/litejs/browser-cookie-lite.\n// It is licensed under the MIT License and authored by Lauri Rooden.\nfunction cookie(name, value, ttl, path, domain, secure) {\n    if (arguments.length > 1) {\n        let newCookie = name + '=' + encodeURIComponent(value) +\n            (ttl ? \"; expires=\" + new Date(+new Date()+(ttl*1000)).toUTCString() : '') +\n            (path   ? \"; path=\" + path : '') +\n            (domain ? \"; domain=\" + domain : '') +\n            (secure ? \"; secure\" : '');\n        document.cookie = newCookie;\n        return newCookie;\n    }\n    return decodeURIComponent(((\"; \"+document.cookie).split(\"; \"+name+\"=\")[1]||\"\").split(\";\")[0]);\n}\n\n/* eslint-enable */\n\nmodule.exports = {\n    cookie : cookie,\n};\n","import _each from '../_each'; // eslint-disable-line camelcase\nimport * as coerce from './coerce.js';\n\nexport default class ReportImp {\n    constructor(runtime, oldestMicros, youngestMicros, spanRecords, internalLogs, counters, timestampOffsetMicros) {\n        this._runtime = runtime;\n        this._oldestMicros = oldestMicros;\n        this._youngestMicros = youngestMicros;\n        this._spanRecords = spanRecords;\n        this._internalLogs = internalLogs;\n        this._counters = counters;\n        this._timestampOffsetMicros = timestampOffsetMicros;\n    }\n\n    getSpanRecords() {\n        return this._spanRecords;\n    }\n\n    getInternalLogs() {\n        return this._internalLogs;\n    }\n\n    getCounters() {\n        return this._counters;\n    }\n\n    toJSON(auth) {\n        _each(this._spanRecords, (span) => {\n            span.runtime_guid = this._runtimeGUID;\n        });\n        let jsonSpanRecords = [];\n        _each(this._spanRecords, (spanRecord) => {\n            jsonSpanRecords.push(spanRecord._toJSON());\n        });\n        return jsonSpanRecords;\n    }\n}\n","\n\nexport default class RuntimeImp {\n    constructor(runtimeGUID, startMicros, componentName, attributes) {\n        this._runtimeGUID = runtimeGUID;\n        this._startMicros = startMicros;\n        this._componentName = componentName;\n        this._attributes = attributes;\n    }\n\n    toJSON() {\n        // NOTE: for legacy reasons, the Thrift field is called \"group_name\"\n        // but is semantically equivalent to the \"component_name\"\n        return {\n            guid         : this._runtimeGUID,\n            start_micros : this._startMicros,\n            group_name   : this._componentName,\n            attrs        : this._attributes,\n        };\n    }\n}\n","import _each from '../_each';\n\nexport default class SpanContextImp {\n\n    // ---------------------------------------------------------------------- //\n    // OpenTracing Implementation\n    // ---------------------------------------------------------------------- //\n\n    setBaggageItem(key, value) {\n        this._baggage[key] = value;\n    }\n\n    getBaggageItem(key) {\n        return this._baggage[key];\n    }\n\n    // ---------------------------------------------------------------------- //\n    // LightStep Extensions\n    // ---------------------------------------------------------------------- //\n\n    // This is part of the formal OT API in Go; and will likely be supported\n    // across platforms.\n    //\n    // https://github.com/opentracing/opentracing.github.io/issues/103\n    forEachBaggageItem(f) {\n        _each(this._baggage, (val, key) => {\n            f(key, val);\n        });\n    }\n\n    // ---------------------------------------------------------------------- //\n    // Private methods\n    // ---------------------------------------------------------------------- //\n\n    constructor(spanGUID, traceGUID) {\n        this._baggage = {};\n        this._guid        = spanGUID;\n        this._traceGUID   = traceGUID;\n    }\n}\n","import * as coerce from './coerce.js';\nimport * as constants from '../constants';\nimport _each from '../_each';\nimport * as opentracing from 'opentracing';\nimport { crouton_thrift } from '../platform_abstraction_layer'; // eslint-disable-line camelcase\nimport LogRecordImp from './log_record_imp'; // eslint-disable-line camelcase\nimport util from './util/util.js';\nlet converter = require('hex2dec');\n\nexport default class SpanImp extends opentracing.Span {\n\n    // ---------------------------------------------------------------------- //\n    // opentracing.Span SPI\n    // ---------------------------------------------------------------------- //\n\n    _tracer() {\n        return this._tracerImp;\n    }\n\n    _context() {\n        return this._ctx;\n    }\n\n    _setOperationName(name) {\n        this._operationName = `${name}`;\n    }\n\n    _addTags(keyValuePairs) {\n        let self = this;\n        _each(keyValuePairs, (value, key) => {\n            self._tags[key] = value;\n        });\n    }\n\n    _log(keyValuePairs, timestamp) {\n        let self = this;\n        const argumentType = typeof keyValuePairs;\n        if (argumentType !== 'object') {\n            self._tracerImp._error('Span.log() expects an object as its first argument');\n            return;\n        }\n\n        let tsMicros = timestamp ?\n            (timestamp * 1000) :\n            self._tracerImp._platform.nowMicros();\n\n        let record = new LogRecordImp(\n            self._tracerImp.getLogFieldKeyHardLimit(),\n            self._tracerImp.getLogFieldValueHardLimit(),\n            tsMicros,\n            keyValuePairs);\n        self._log_records = self._log_records || [];\n        self._log_records.push(record);\n        self._tracerImp.emit('log_added', record);\n    }\n\n    _finish(finishTime) {\n        return this.end(finishTime);\n    }\n\n    // ---------------------------------------------------------------------- //\n    // Private methods\n    // ---------------------------------------------------------------------- //\n\n    constructor(tracer, name, spanContext) {\n        super();\n\n        console.assert(typeof tracer === 'object', 'Invalid runtime');  // eslint-disable-line no-console\n\n        this._tracerImp = tracer;\n        this._ctx = spanContext;\n        this._ended  = false;\n\n        this._operationName = name;\n        this._tags          = {};\n        this._beginMicros   = tracer._platform.nowMicros();\n        this._endMicros     = 0;\n        this._errorFlag     = false;\n        this._log_records   = null;\n    }\n\n    // ---------------------------------------------------------------------- //\n    // Splunk Extensions\n    // ---------------------------------------------------------------------- //\n\n    getOperationName() {\n        return this._operationName;\n    }\n\n    // Getter only. The GUID is immutable once set internally.\n    guid() {\n        return this._ctx._guid;\n    }\n\n    traceGUID() {\n        return this._ctx._traceGUID;\n    }\n\n    parentGUID() {\n        return this._tags.parent_span_guid;\n    }\n\n    setParentGUID(guid) {\n        this._tags.parent_span_guid = coerce.toString(guid);\n        return this;\n    }\n\n    beginMicros() {\n        return this._beginMicros;\n    }\n\n    setBeginMicros(micros) {\n        this._beginMicros = micros;\n        return this;\n    }\n\n    endMicros() {\n        return this._endMicros;\n    }\n\n    setEndMicros(micros) {\n        this._endMicros = micros;\n        return this;\n    }\n\n    /**\n     * Returns a URL to the trace containing this span.\n     *\n     * Unlike most methods, it *is* safe to call this method after `finish()`.\n     *\n     * @return {string} the absolute URL for the span\n     */\n    generateTraceURL() {\n        let micros;\n        if (this._beginMicros > 0 && this._endMicros > 0) {\n            micros = Math.floor((this._beginMicros + this._endMicros) / 2);\n        } else {\n            micros = this._tracerImp._platform.nowMicros();\n        }\n\n        let urlPrefix = constants.SPLUNK_APP_URL_PREFIX;\n        let accessToken = encodeURIComponent(this._tracerImp.options().access_token);\n        let guid = encodeURIComponent(this.guid());\n        return `${urlPrefix}/${accessToken}/trace?span_guid=${guid}&at_micros=${micros}`;\n    }\n\n    getTags() {\n        return this._tags;\n    }\n\n    /**\n     * Finishes the span.\n     *\n     * @param  {Number} finishTime\n     *         \tOptional Unix timestamp in milliseconds setting an explicit\n     *         \tfinish time for the span.\n     */\n    end(finishTime) {\n        // Ensure a single span is not recorded multiple times\n        if (this._ended) {\n            return;\n        }\n        this._ended = true;\n\n        if (finishTime !== undefined) {\n            this.setEndMicros(Math.floor(finishTime * 1000));\n        }\n\n        // Do not set endMicros if it has already been set. This accounts for\n        // the case of a span that has had it's times set manually (i.e. allows\n        // for retroactively created spans that might not be possible to create\n        // in real-time).\n        if (this._endMicros === 0) {\n            this.setEndMicros(this._tracerImp._platform.nowMicros());\n        }\n\n        if (util.shouldSendMetaSpan(this._tracer().options(), this.getTags())) {\n            this._tracerImp.startSpan(constants.SPL_META_SP_FINISH, {\n                tags : {\n                    [constants.SPL_META_EVENT_KEY] : true,\n                    [constants.SPL_META_TRACE_KEY] : this.traceGUID(),\n                    [constants.SPL_META_SPAN_KEY]  : this.guid(),\n                },\n            }).finish();\n        }\n\n        // console.log(this._log_records);\n        this._tracerImp._addSpanRecord(this);\n    }\n\n    _toJSON() {\n        var obj_array = []\n        var json_span = { event: {\n            span_id         : this.guid(),\n            trace_id        : this.traceGUID(),\n            parent_span_id  : this.parentGUID(),\n            runtime_guid    : this._tracerImp.guid(),\n            baggage         : this._ctx.baggage,\n            component_name  : this._tracerImp._options.component_name,\n            operation_name  : this._operationName,\n            duration        : this._endMicros - this._beginMicros,\n            timestamp       : this._beginMicros / 1000000,\n            tags            : this._tags,\n            error_flag      : this._errorFlag,\n        },\n        sourcetype: \"splunktracing:span\",\n        time: this._beginMicros/1000000\n        };\n        _each(this._tracerImp._runtime._attributes, (value, key) =>  {\n            json_span.event[key] = value\n        });\n        delete json_span.event.tags.parent_span_guid;\n        obj_array.push(JSON.stringify(json_span));\n        _each(this._log_records, (value, key) =>  {\n            var json_log = { event: {\n                    fields: value._fields,\n                    timestamp: value._timestampMicros / 1000000\n                   },\n               sourcetype: \"splunktracing:log\",\n               time: value._timestampMicros / 1000000\n            }\n            _each(json_span.event, (value1, key1) => {\n                if ( key1!=\"timestamp\" && key1!=\"duration\" ) {\n                    json_log.event[key1] = value1;\n                }\n            });\n            try {\n                obj_array.push(JSON.stringify(json_log));\n            } catch (err) {\n                this._tracerImp._error('Span.log() contains circular data structure');\n            }\n        });\n        // console.log(obj_array);\n        return obj_array.join(\"\\n\");\n    }\n}\n","//============================================================================//\n// Imports\n//============================================================================//\n\nimport EventEmitter from 'eventemitter3';\nimport * as opentracing from 'opentracing';\n\nimport SpanContextImp from './span_context_imp';\nimport SpanImp from './span_imp';\nimport _each from '../_each';\nimport { Platform, HTTPTransport } from '../platform_abstraction_layer';\nimport AuthImp from './auth_imp';\nimport RuntimeImp from './runtime_imp';\nimport ReportImp from './report_imp';\n\nconst ClockState    = require('./util/clock_state');\nconst LogBuilder    = require('./log_builder');\nconst coerce        = require('./coerce');\nconst constants     = require('../constants');\nconst globals       = require('./globals');\nconst packageObject = require('../../package.json');\nconst util          = require('./util/util');\n\nconst CARRIER_TRACER_STATE_PREFIX = 'ot-tracer-';\nconst CARRIER_BAGGAGE_PREFIX = 'ot-baggage-';\n\nconst DEFAULT_COLLECTOR_HOSTNAME   = '127.0.0.1';\nconst DEFAULT_COLLECTOR_PORT_TLS   = 8088;\nconst DEFAULT_COLLECTOR_PORT_PLAIN = 8088;\nconst DEFAULT_COLLECTOR_PATH       = '';\n\n// Internal errors should be rare. Set a low limit to ensure a cascading failure\n// does not compound an existing problem by trying to send a great deal of\n// internal error data.\nconst MAX_INTERNAL_LOGS = 20;\n\nlet _singleton = null;\n\nexport default class Tracer extends opentracing.Tracer {\n\n    constructor(opts) {\n        super();\n\n        this._delegateEventEmitterMethods();\n\n        opts = opts || {};\n\n        if (!_singleton) {\n            globals.setOptions(opts);\n            _singleton = this;\n        }\n\n        // Platform abstraction layer\n        this._platform = new Platform(this);\n        this._runtimeGUID = opts.guid || this.override_runtime_guid || null;  // Set once the group name is set\n        this._plugins = {};\n        this._options = {};\n        this._optionDescs = [];\n        this._makeOptionsTable();\n\n        this._opentracing = opentracing;\n        if (opts.opentracing_module) {\n            this._opentracing = opts.opentracing_module;\n        }\n\n        let now = this._platform.nowMicros();\n\n        // The thrift authentication and runtime struct are created as soon as\n        // the necessary initialization options are available.\n        this._startMicros = now;\n        this._auth = null;\n        this._runtime = null;\n\n        let logger = {\n            warn  : (msg, payload) => { this._warn(msg, payload); },\n            error : (err, payload) => { this._error(err, payload); },\n        };\n\n        if (opts) {\n            this._transport = opts.override_transport;\n        }\n\n        this._reportingLoopActive = false;\n        this._first_report_has_run = false;\n        this._reportYoungestMicros = now;\n        this._reportTimer = null;\n        this._reportErrorStreak = 0;    // Number of consecutive errors\n        this._lastVisibleErrorMillis = 0;\n        this._skippedVisibleErrors = 0;\n\n        // Set addActiveRootSpan() for detail\n        this._activeRootSpanSet = {};\n        this._activeRootSpan = null;\n\n        // Span reporting buffer and per-report data\n        // These data are reset on every successful report.\n        this._spanRecords = [];\n\n        // The counter names need to match those accepted by the collector.\n        // These are internal counters only.\n        this._counters = {\n            'internal.errors'        : 0,\n            'internal.warnings'      : 0,\n            'spans.dropped'          : 0,\n            'logs.dropped'           : 0,\n            'logs.keys.over_limit'   : 0,\n            'logs.values.over_limit' : 0,\n            'reports.errors.send'    : 0,\n        };\n\n        // For internal (not client) logs reported to the collector\n        this._internalLogs = [];\n\n        // Current runtime state / status\n        this._flushIsActive = false;\n\n        // Built-in plugins\n        this.addPlugin(require('../plugins/log_to_console'));\n\n        // Initialize the platform options after the built-in plugins in\n        // case any of those options affect the built-ins.\n        this.addPlatformPlugins(opts);\n        this.setPlatformOptions(opts);\n\n        // Set constructor arguments\n        if (opts) {\n            this.options(opts);\n        }\n        if (typeof this._transport === 'undefined' || this._transport === null) {\n            switch (this._options.transport) {\n            default:\n                this._transport = new HTTPTransport(logger);\n                this._info('Using JSON over HTTP transport per user-defined option.');\n            }\n        }\n\n        // For clock skew adjustment.\n        // Must be set after options have been set.\n        this._useClockState = !this._options.disable_clock_skew_correction;\n        this._clockState = new ClockState({\n            nowMicros     : () => this._platform.nowMicros(),\n            localStoreGet : () => {\n                let key = `clock_state/${this._options.collector_host}`;\n                return this._platform.localStoreGet(key);\n            },\n            localStoreSet : (value) => {\n                let key = `clock_state/${this._options.collector_host}`;\n                return this._platform.localStoreSet(key, value);\n            },\n        });\n\n        // This relies on the options being set: call this last.\n        this._setupReportOnExit();\n\n        this._info(`Tracer created with guid ${this._runtimeGUID}`);\n\n        if (this._options.access_token.length === 0) {\n            this._warn(\n            `Access token not set -\n            this requires a satellite with access token checking disabled,\n            such as a developer satellite.`);\n        }\n\n        this.startPlugins();\n    }\n\n    // Morally speaking, Tracer also inherits from EventEmmiter, but we must\n    // fake it via composition.\n    //\n    // If not obvious on inspection: a hack.\n    _delegateEventEmitterMethods() {\n        let self = this;\n        this._ee = new EventEmitter();\n        // The list of methods at https://nodejs.org/api/events.html\n        _each([\n            'addListener',\n            'emit',\n            'eventNames',\n            'getMaxListeners',\n            'listenerCount',\n            'listeners',\n            'on',\n            'once',\n            'prependListener',\n            'prependOnceListener',\n            'removeAllListeners',\n            'removeListener',\n            'setMaxListeners',\n        ], (methodName) => {\n            self[methodName] = function () {\n                if (self._ee[methodName]) {\n                    self._ee[methodName].apply(self._ee, arguments);\n                }\n            };\n        });\n    }\n\n    _makeOptionsTable() {\n        /* eslint-disable key-spacing, no-multi-spaces */\n\n        // NOTE: make 'verbosity' the first option so it is processed first on\n        // options changes and takes effect as soon as possible.\n        this.addOption('verbosity',             { type : 'int', min: 0, max: 9, defaultValue: 1 });\n\n        // Core options\n        this.addOption('access_token',          { type: 'string',  defaultValue: '' });\n        this.addOption('component_name',        { type: 'string',  defaultValue: '' });\n        this.addOption('collector_host',        { type: 'string',  defaultValue: DEFAULT_COLLECTOR_HOSTNAME });\n        this.addOption('collector_port',        { type: 'int',     defaultValue: DEFAULT_COLLECTOR_PORT_TLS });\n        this.addOption('collector_path',        { type: 'string',  defaultValue: DEFAULT_COLLECTOR_PATH });\n        this.addOption('collector_encryption',  { type: 'string',  defaultValue: 'tls' });\n        this.addOption('tags',                  { type: 'any',     defaultValue: {} });\n        this.addOption('max_reporting_interval_millis',  { type: 'int',     defaultValue: 2500 });\n        this.addOption('disable_clock_skew_correction', { type: 'bool', defaultValue: true });\n        this.addOption('transport',             { type: 'string', defaultValue: 'proto' });\n\n        // Non-standard, may be deprecated\n        this.addOption('disabled',              { type: 'bool',    defaultValue: false });\n        this.addOption('max_span_records',      { type: 'int',     defaultValue: 4096 });\n        this.addOption('default_span_tags',     { type: 'any',     defaultValue: {} });\n        this.addOption('report_timeout_millis', { type: 'int',     defaultValue: 30000 });\n        this.addOption('gzip_json_requests',    { type: 'bool',    defaultValue: true });\n        this.addOption('disable_reporting_loop', { type: 'bool',    defaultValue: false });\n        this.addOption('disable_report_on_exit', { type: 'bool',    defaultValue: false });\n        this.addOption('delay_initial_report_millis', { type: 'int', defaultValue: 1000 });\n        this.addOption('error_throttle_millis', { type: 'int',     defaultValue: 60000 });\n        this.addOption('logger',                { type: 'function', defaultValue: this._printToConsole.bind(this) });\n\n        // Debugging options\n        //\n        // These are not part of the supported public API.\n        //\n        // If false, SSL certificate verification is skipped. Useful for testing.\n        this.addOption('certificate_verification',      { type: 'bool',    defaultValue: true });\n        // I.e. report only on explicit calls to flush()\n\n        // Unit testing options\n        this.addOption('override_transport',            { type : 'any',    defaultValue: null });\n        this.addOption('silent',                        { type : 'bool',   defaultValue: false });\n\n        // Hard upper limits to protect against worst-case scenarios for log field sizes.\n        this.addOption('log_field_key_hard_limit',   { type: 'int',     defaultValue: 256 });\n        this.addOption('log_field_value_hard_limit', { type: 'int',     defaultValue: 1024 });\n\n        // Meta Event reporting options\n        this.addOption('disable_meta_event_reporting', { type: 'bool', defaultValue: false });\n\n        /* eslint-disable key-spacing, no-multi-spaces */\n    }\n\n    // ---------------------------------------------------------------------- //\n    // opentracing.Tracer SPI\n    // ---------------------------------------------------------------------- //\n\n    _startSpan(name, fields) {\n        // First, assemble the SpanContextImp for our SpanImp.\n        let parentCtxImp = null;\n        fields = fields || {};\n        if (fields.references) {\n            for (let i = 0; i < fields.references.length; i++) {\n                let ref = fields.references[i];\n                let type = ref.type();\n                if (type === this._opentracing.REFERENCE_CHILD_OF ||\n                    type === this._opentracing.REFERENCE_FOLLOWS_FROM) {\n                    let context = ref.referencedContext();\n                    if (!context) {\n                        this._error('Span reference has an invalid context', context);\n                        continue;\n                    }\n                    parentCtxImp = context;\n                    break;\n                }\n            }\n        }\n\n        let traceGUID = parentCtxImp ? parentCtxImp._traceGUID : this.generateTraceGUIDForRootSpan();\n        let spanImp = new SpanImp(this, name, new SpanContextImp(this._platform.generateUUID(), traceGUID));\n        spanImp.addTags(this._options.default_span_tags);\n\n        _each(fields, (value, key) => {\n            switch (key) {\n            case 'references':\n                // Ignore: handled before constructing the span\n                break;\n            case 'startTime':\n                // startTime is in milliseconds\n                spanImp.setBeginMicros(Math.floor(value * 1000));\n                break;\n            case 'tags':\n                spanImp.addTags(value);\n                break;\n            default:\n                this._warn(`Ignoring unknown field '${key}'`);\n                break;\n            }\n        });\n\n        if (parentCtxImp !== null) {\n            spanImp.setParentGUID(parentCtxImp._guid);\n        }\n\n        this.emit('start_span', spanImp);\n\n        if (util.shouldSendMetaSpan(this.options(), spanImp.getTags())) {\n            this.startSpan(constants.SPL_META_SP_START,\n                {\n                    tags : {\n                        [constants.SPL_META_EVENT_KEY]: true,\n                        [constants.SPL_META_TRACE_KEY]: spanImp.traceGUID(),\n                        [constants.SPL_META_SPAN_KEY]: spanImp.guid(),\n                    },\n                })\n                .finish();\n        }\n        return spanImp;\n    }\n\n    _inject(spanContext, format, carrier) {\n        switch (format) {\n        case this._opentracing.FORMAT_HTTP_HEADERS:\n        case this._opentracing.FORMAT_TEXT_MAP:\n            if (this.options().meta_event_reporting === true) {\n                this.startSpan(constants.SPL_META_INJECT,\n                    {\n                        tags: {\n                            [constants.SPL_META_EVENT_KEY]: true,\n                            [constants.SPL_META_TRACE_KEY]: spanContext._traceGUID,\n                            [constants.SPL_META_SPAN_KEY]: spanContext._guid,\n                            [constants.SPL_META_PROPAGATION_KEY]: format,\n                        },\n                    })\n                .finish();\n            }\n            this._injectToTextMap(spanContext, carrier);\n            break;\n\n        case this._opentracing.FORMAT_BINARY:\n            this._error(`Unsupported format: ${format}`);\n            break;\n\n        default:\n            this._error(`Unknown format: ${format}`);\n            break;\n        }\n    }\n\n    _injectToTextMap(spanContext, carrier) {\n        if (!carrier) {\n            this._error('Unexpected null FORMAT_TEXT_MAP carrier in call to inject');\n            return;\n        }\n        if (typeof carrier !== 'object') {\n            this._error(`Unexpected '${typeof carrier}' FORMAT_TEXT_MAP carrier in call to inject`);\n            return;\n        }\n\n        carrier[`${CARRIER_TRACER_STATE_PREFIX}spanid`] = spanContext._guid;\n        carrier[`${CARRIER_TRACER_STATE_PREFIX}traceid`] = spanContext._traceGUID;\n        spanContext.forEachBaggageItem((key, value) => {\n            carrier[`${CARRIER_BAGGAGE_PREFIX}${key}`] = value;\n        });\n        carrier[`${CARRIER_TRACER_STATE_PREFIX}sampled`] = 'true';\n        return carrier;\n    }\n\n    _extract(format, carrier) {\n        let sc;\n        switch (format) {\n        case this._opentracing.FORMAT_HTTP_HEADERS:\n        case this._opentracing.FORMAT_TEXT_MAP:\n            sc = this._extractTextMap(format, carrier);\n            if (this.options().meta_event_reporting === true) {\n                this.startSpan(constants.SPL_META_EXTRACT,\n                    {\n                        tags: {\n                            [constants.SPL_META_EVENT_KEY]: true,\n                            [constants.SPL_META_TRACE_KEY]: sc._traceGUID,\n                            [constants.SPL_META_SPAN_KEY]: sc._guid,\n                            [constants.SPL_META_PROPAGATION_KEY]: format,\n                        },\n                    })\n                .finish();\n            }\n            return sc;\n        case this._opentracing.FORMAT_BINARY:\n            this._error(`Unsupported format: ${format}`);\n            return null;\n\n        default:\n            this._error(`Unsupported format: ${format}`);\n            return null;\n        }\n    }\n\n    _extractTextMap(format, carrier) {\n        // Begin with the empty SpanContextImp\n        let spanContext = new SpanContextImp(null, null);\n\n        // Iterate over the contents of the carrier and set the properties\n        // accordingly.\n        let foundFields = 0;\n        _each(carrier, (value, key) => {\n            key = key.toLowerCase();\n            if (key.substr(0, CARRIER_TRACER_STATE_PREFIX.length) !== CARRIER_TRACER_STATE_PREFIX) {\n                return;\n            }\n            let suffix = key.substr(CARRIER_TRACER_STATE_PREFIX.length);\n\n            switch (suffix) {\n            case 'traceid':\n                foundFields++;\n                spanContext._traceGUID = value;\n                break;\n            case 'spanid':\n                foundFields++;\n                spanContext._guid = value;\n                break;\n            case 'sampled':\n                // Ignored. The carrier may be coming from a different client\n                // library that sends this (even though it's not used).\n                break;\n            default:\n                this._error(`Unrecognized carrier key '${key}' with recognized prefix. Ignoring.`);\n                break;\n            }\n        });\n\n        if (foundFields === 0) {\n            // This is not an error per se, there was simply no SpanContext\n            // in the carrier.\n            return null;\n        }\n        if (foundFields < 2) {\n            // A partial SpanContext suggests some sort of data corruption.\n            this._error(`Only found a partial SpanContext: ${format}, ${carrier}`);\n            return null;\n        }\n\n        _each(carrier, (value, key) => {\n            key = key.toLowerCase();\n            if (key.substr(0, CARRIER_BAGGAGE_PREFIX.length) !== CARRIER_BAGGAGE_PREFIX) {\n                return;\n            }\n            let suffix = key.substr(CARRIER_BAGGAGE_PREFIX.length);\n            spanContext.setBaggageItem(suffix, value);\n        });\n        return spanContext;\n    }\n\n\n    // ---------------------------------------------------------------------- //\n    // Splunk extensions\n    // ---------------------------------------------------------------------- //\n\n    /**\n     * Manually sends a report of all buffered data.\n     *\n     * @param  {Function} done - callback function invoked when the report\n     *         either succeeds or fails.\n     */\n    flush(done) {\n        if (!done) {\n            done = function () {};\n        }\n        if (this._options.disabled) {\n            this._warn('Manual flush() called in disabled state.');\n            return done(null);\n        }\n        this._flushReport(true, false, done);\n    }\n\n    //-----------------------------------------------------------------------//\n    // Options\n    //-----------------------------------------------------------------------//\n\n    guid() {\n        return this._runtimeGUID;\n    }\n\n    verbosity() {\n        // The 'undefined' handling below is for logs that may occur before the\n        // options are initialized.\n        let v = this._options.verbosity;\n        return (v === undefined) ? 1 : v;\n    }\n\n    // Call to generate a new Trace GUID\n    generateTraceGUIDForRootSpan() {\n        let guid = this._platform.generateUUID();\n        if (this._activeRootSpan) {\n            guid = this._activeRootSpan.traceGUID();\n        }\n        return guid;\n    }\n\n    setPlatformOptions(userOptions) {\n        let opts = this._platform.options(this) || {};\n        _each(userOptions, (val, key) => {\n            opts[key] = val;\n        });\n        this.options(opts);\n    }\n\n    // Register a new option.  Used by plug-ins.\n    addOption(name, desc) {\n        desc.name = name;\n        this._optionDescs.push(desc);\n        this._options[desc.name] = desc.defaultValue;\n    }\n\n    options(opts) {\n        if (arguments.length === 0) {\n            console.assert(typeof this._options === 'object',   // eslint-disable-line\n                'Internal error: _options field incorrect');\n            return this._options;\n        }\n        if (typeof opts !== 'object') {\n            throw new Error(`options() must be called with an object: type was ${typeof opts}`);\n        }\n\n        // \"collector_port\" 0 acts as an alias for \"use the default\".\n        if (opts.collector_port === 0) {\n            delete opts.collector_port;\n        }\n\n        // \"collector_encryption\" acts an alias for the common cases of 'collector_port'\n        if (opts.collector_encryption !== undefined && opts.collector_port === undefined) {\n            opts.collector_port = opts.collector_encryption !== 'none' ?\n                DEFAULT_COLLECTOR_PORT_TLS :\n                DEFAULT_COLLECTOR_PORT_PLAIN;\n        }\n        // set meta event reporting to false by default, it will be enabled by the satellite\n        this.meta_event_reporting = false;\n\n        // Track what options have been modified\n        let modified = {};\n        let unchanged = {};\n        _each(this._optionDescs, (desc) => {\n            this._setOptionInternal(modified, unchanged, opts, desc);\n        });\n\n        // Check for any invalid options: is there a key in the specified operation\n        // that didn't result either in a change or a reset to the existing value?\n        for (let key in opts) {\n            if (modified[key] === undefined && unchanged[key] === undefined) {\n                this._warn(`Invalid option ${key} with value ${opts[key]}`);\n            }\n        }\n\n        //\n        // Update the state information based on the changes\n        //\n        this._initReportingDataIfNeeded(modified);\n\n        if (!this._reportingLoopActive) {\n            this._startReportingLoop();\n        }\n\n        if (this.verbosity() >= 3) {\n            let optionsString = '';\n            let count = 0;\n            _each(modified, (val, key) => {\n                optionsString += `\\t${JSON.stringify(key)}: ${JSON.stringify(val.newValue)}\\n`;\n                count++;\n            });\n            if (count > 0) {\n                this._debug(`Options modified:\\n${optionsString}`);\n            }\n        }\n        this.emit('options', modified, this._options, this);\n    }\n\n    _setOptionInternal(modified, unchanged, opts, desc) {\n        let name = desc.name;\n        let value = opts[name];\n        let valueType = typeof value;\n        if (value === undefined) {\n            return;\n        }\n\n        // Parse the option (and check constraints)\n        switch (desc.type) {\n\n        case 'any':\n            break;\n\n        case 'bool':\n            if (value !== true && value !== false) {\n                this._error(`Invalid boolean option '${name}' '${value}'`);\n                return;\n            }\n            break;\n\n        case 'function':\n            if (typeof value !== 'function') {\n                this._error(`Invalid function option '${name}' '${value}'`);\n                return;\n            }\n            break;\n\n        case 'int':\n            if (valueType !== 'number' || Math.floor(value) !== value) {\n                this._error(`Invalid int option '${name}' '${value}'`);\n                return;\n            }\n            if (desc.min !== undefined && desc.max !== undefined) {\n                if (!(value >= desc.min && value <= desc.max)) {\n                    this._error(`Option '${name}' out of range '${value}' is not between ${desc.min} and ${desc.max}`);  // eslint-disable-line max-len\n                    return;\n                }\n            }\n            break;\n\n        case 'string':\n            switch (valueType) {\n            case 'string':\n                break;\n            case 'number':\n                value = coerce.toString(value);\n                break;\n            default:\n                this._error(`Invalid string option ${name} ${value}`);\n                return;\n            }\n            break;\n\n        case 'array':\n            // Per http://stackoverflow.com/questions/4775722/check-if-object-is-array\n            if (Object.prototype.toString.call(value) !== '[object Array]') {\n                this._error(`Invalid type for array option ${name}: found '${valueType}'`);\n                return;\n            }\n            break;\n\n        default:\n            this._error(`Unknown option type '${desc.type}'`);\n            return;\n        }\n\n        // Set the new value, recording any modifications\n        let oldValue = this._options[name];\n        if (oldValue === undefined) {\n            throw new Error(`Attempt to set unknown option ${name}`);\n        }\n\n        // Ignore no-op changes for types that can be checked quickly\n        if (valueType !== 'object' && oldValue === value) {\n            unchanged[name] = true;\n            return;\n        }\n\n        modified[name] = {\n            oldValue : oldValue,\n            newValue : value,\n        };\n        this._options[name] = value;\n    }\n\n    // The authorization and runtime information is initialized as soon\n    // as it is available.  This allows logs and spans to be buffered before\n    // the library is initialized, which can be helpul in a complex setup with\n    // many subsystems.\n    //\n    _initReportingDataIfNeeded(modified) {\n        // Ignore redundant initialization; complaint on inconsistencies\n        if (this._auth !== null) {\n            if (!this._runtime) {\n                return this._error('Inconsistent state: auth initialized without runtime.');\n            }\n            if (modified.access_token) {\n                throw new Error('Cannot change access_token after it has been set.');\n            }\n            if (modified.component_name) {\n                throw new Error('Cannot change component_name after it has been set.');\n            }\n            if (modified.collector_host) {\n                throw new Error('Cannot change collector_host after the connection is established');\n            }\n            if (modified.collector_port) {\n                throw new Error('Cannot change collector_port after the connection is established');\n            }\n            if (modified.collector_path) {\n                throw new Error('Cannot change collector_path after the connection is established');\n            }\n            if (modified.collector_encryption) {\n                throw new Error('Cannot change collector_encryption after the connection is established');\n            }\n            return;\n        }\n\n        this._runtimeGUID = this._platform.runtimeGUID(this._options.component_name);\n\n        this._auth = new AuthImp(this._options.access_token);\n\n        //\n        // Assemble the tracer tags from the user-specified and automatic,\n        // internal tags.\n        //\n        let tags = {};\n        _each(this._options.tags, (value, key) => {\n            if (typeof value !== 'string') {\n                this._error(`Tracer tag value is not a string: key=${key}`);\n                return;\n            }\n            tags[key] = value;\n        });\n        tags['tracer_version'] = packageObject.version;\n        let platformTags = this._platform.tracerTags();\n        _each(platformTags, (val, key) => {\n            tags[key] = val;\n        });\n\n        this._runtime = new RuntimeImp(this._runtimeGUID, this._startMicros, this._options.component_name, tags);\n\n        this._info('Initializing reporting data', {\n            component_name : this._options.component_name,\n            access_token   : this._auth.getAccessToken(),\n        });\n        this.emit('reporting_initialized');\n    }\n\n    getLogFieldKeyHardLimit() {\n        return this._options.log_field_key_hard_limit;\n    }\n\n    getLogFieldValueHardLimit() {\n        return this._options.log_field_value_hard_limit;\n    }\n\n    //-----------------------------------------------------------------------//\n    // Plugins\n    //-----------------------------------------------------------------------//\n\n    addPlatformPlugins(opts) {\n        let pluginSet = this._platform.plugins(opts);\n        _each(pluginSet, (val) => {\n            this.addPlugin(val);\n        });\n    }\n\n    addPlugin(plugin) {\n        // Don't add plug-ins twice\n        let name = plugin.name();\n        if (this._plugins[name]) {\n            return;\n        }\n\n        this._plugins[name] = plugin;\n        plugin.addOptions(this);\n    }\n\n    startPlugins() {\n        _each(this._plugins, (val, key) => {\n            this._plugins[key].start(this);\n        });\n    }\n\n    //-----------------------------------------------------------------------//\n    // Spans\n    //-----------------------------------------------------------------------//\n\n    // This is a Splunk-specific feature that should be used sparingly. It\n    // sets a \"global\" root span such that spans that would *otherwise* be root\n    // span instead inherit the trace GUID of the active root span. This is\n    // best clarified by example:\n    //\n    // On document load in the browser, an \"active root span\" is created for\n    // the page load process. Any spans started without an explicit parent\n    // will the document load trace GUID instead of starting a trace GUID.\n    // This implicit root remains active only until the page is done loading.\n    //\n    // Any span adding itself as a root span *must* remove itself along with\n    // calling finish(). This will *not* be done automatically.\n    //\n    // NOTE: currently, only the trace GUID is transferred; it may or may not\n    // make sure to make this a proper parent.\n    //\n    // NOTE: the root span tracking is handled as a set rather than a single\n    // global to avoid conflicts between libraries.\n    addActiveRootSpan(span) {\n        this._activeRootSpanSet[span._guid] = span;\n        this._setActiveRootSpanToYoungest();\n    }\n\n    removeActiveRootSpan(span) {\n        delete this._activeRootSpanSet[span._guid];\n        this._setActiveRootSpanToYoungest();\n    }\n\n    _setActiveRootSpanToYoungest() {\n        // Set the _activeRootSpan to the youngest of the roots in case of\n        // multiple.\n        this._activeRootSpan = null;\n        _each(this._activeRootSpanSet, (span) => {\n            if (!this._activeRootSpan ||\n                span._beginMicros > this._activeRootSpan._beginMicros) {\n                this._activeRootSpan = span;\n            }\n        });\n    }\n\n    //-----------------------------------------------------------------------//\n    // Encoding / decoding\n    //-----------------------------------------------------------------------//\n\n    _objectToUint8Array(obj) {\n        let jsonString;\n        try {\n            // encodeURIComponent() is a *very* inefficient, but simple and\n            // well-supported way to avoid having to think about Unicode in\n            // in the conversion to a UInt8Array.\n            //\n            // Writing multiple bytes for String.charCodeAt and\n            // String.codePointAt would be an alternate approach; again,\n            // simplicitly is being preferred over efficiency for the moment.\n            jsonString = encodeURIComponent(JSON.stringify(obj));\n        } catch (e) {\n            this._error('Could not binary encode carrier data.');\n            return null;\n        }\n\n        let buffer = new ArrayBuffer(jsonString.length);\n        let view = new Uint8Array(buffer);\n        for (let i = 0; i < jsonString.length; i++) {\n            let code = jsonString.charCodeAt(i);\n            if (!(code >= 0 && code <= 255)) {\n                this._error('Unexpected character code');\n                return null;\n            }\n            view[i] = code;\n        }\n        return view;\n    }\n\n    _uint8ArrayToObject(arr) {\n        if (!arr) {\n            this._error('Array is null');\n            return null;\n        }\n\n        let jsonString = '';\n        for (let i = 0; i < arr.length; i++) {\n            jsonString += String.fromCharCode(arr[i]);\n        }\n        try {\n            return JSON.parse(decodeURIComponent(jsonString));\n        } catch (e) {\n            this._error('Could not decode binary data.');\n            return null;\n        }\n    }\n\n    //-----------------------------------------------------------------------//\n    // Logging\n    //-----------------------------------------------------------------------//\n\n    log() {\n        let b = new LogBuilder(this);\n        return b;\n    }\n\n    //-----------------------------------------------------------------------//\n    // Buffers\n    //-----------------------------------------------------------------------//\n\n    _clearBuffers() {\n        this._spanRecords = [];\n        this._internalLogs = [];\n\n        // Create a new object to avoid overwriting the values in any references\n        // to the old object\n        let counters = {};\n        _each(this._counters, (unused, key) => {\n            counters[key] = 0;\n        });\n        this._counters = counters;\n    }\n\n    _buffersAreEmpty() {\n        if (this._spanRecords.length > 0) {\n            return false;\n        }\n        if (this._internalLogs.length > 0) {\n            return false;\n        }\n\n        let countersAllZero = true;\n        _each(this._counters, (val) => {\n            if (val > 0) {\n                countersAllZero = false;\n            }\n        });\n        return countersAllZero;\n    }\n\n    _addSpanRecord(record) {\n        this._internalAddSpanRecord(record);\n        this.emit('span_added', record);\n    }\n\n    _internalAddSpanRecord(record) {\n        if (!record) {\n            this._error('Attempt to add null record to buffer');\n            return;\n        }\n\n        if (this._spanRecords.length >= this._options.max_span_records) {\n            let index = Math.floor(this._spanRecords.length * Math.random());\n            this._spanRecords[index] = record;\n            this._counters['spans.dropped']++;\n        } else {\n            this._spanRecords.push(record);\n        }\n    }\n\n    _restoreRecords(spans, internalLogs, counters) {\n        _each(spans, (span) => {\n            this._internalAddSpanRecord(span);\n        });\n\n        let currentInternalLogs = this._internalLogs;\n        this._internalLogs = [];\n        let toAdd = internalLogs.concat(currentInternalLogs);\n        _each(toAdd, (log) => {\n            this._pushInternalLog(log);\n        });\n\n        _each(counters, (value, key) => {\n            if (key in this._counters) {\n                this._counters[key] += value;\n            } else {\n                this._error(`Bad counter name: ${key}`);\n            }\n        });\n    }\n\n    //-----------------------------------------------------------------------//\n    // Reporting loop\n    //-----------------------------------------------------------------------//\n\n    _setupReportOnExit() {\n        if (this._options.disable_report_on_exit) {\n            this._debug('report-on-exit is disabled.');\n            return;\n        }\n\n        // Do a final explicit flush. Note that the final flush may enqueue\n        // asynchronous callbacks that cause the 'beforeExit' event to be\n        // re-emitted when those callbacks finish.\n        let finalFlushOnce = 0;\n        let finalFlush = () => {\n            if (finalFlushOnce++ > 0) { return; }\n            this._info('Final flush before exit.');\n            this._flushReport(false, true, (err) => {\n                if (err) {\n                    this._warn('Final report before exit failed', {\n                        error                  : err,\n                        unflushed_spans        : this._spanRecords.length,\n                        buffer_youngest_micros : this._reportYoungestMicros,\n                    });\n                }\n            });\n        };\n        this._platform.onBeforeExit(finalFlush);\n    }\n\n    _startReportingLoop() {\n        if (this._options.disabled) {\n            this._info('Not starting reporting loop: instrumentation is disabled.');\n            return;\n        }\n        if (this._options.disable_reporting_loop) {\n            this._info('Not starting reporting loop: reporting loop is disabled.');\n            return;\n        }\n        if (this._auth === null) {\n            // Don't start the loop until the thrift data necessary to do the\n            // report is set up.\n            return;\n        }\n        if (this._reportingLoopActive) {\n            this._info('Reporting loop already started!');\n            return;\n        }\n\n        this._info('Starting reporting loop:', this._runtime);\n        this._reportingLoopActive = true;\n\n        // Stop the reporting loop so the Node.js process does not become a\n        // zombie waiting for the timers.\n        let stopReportingOnce = 0;\n        let stopReporting = () => {\n            if (stopReportingOnce++ > 0) { return; }\n            this._stopReportingLoop();\n        };\n        this._platform.onBeforeExit(stopReporting);\n\n        // Begin the asynchronous reporting loop\n        let loop = () => {\n            this._enqueueNextReport((err) => {\n                if (this._reportingLoopActive) {\n                    loop();\n                }\n            });\n        };\n\n        const delay = Math.floor(Math.random() * this._options.delay_initial_report_millis);\n        util.detachedTimeout(() => {\n            loop();\n        }, delay);\n    }\n\n    _stopReportingLoop() {\n        this._debug('Stopping reporting loop');\n\n        this._reportingLoopActive = false;\n        clearTimeout(this._reportTimer);\n        this._reportTimer = null;\n    }\n\n    _enqueueNextReport(done) {\n        // If there's already a report request enqueued, ignore this new\n        // request.\n        if (this._reportTimer) {\n            return;\n        }\n\n        // If the clock state is still being primed, potentially use the\n        // shorted report interval.\n        //\n        // However, do not use the shorter interval in the case of an error.\n        // That does not provide sufficient backoff.\n        let reportInterval = this._options.max_reporting_interval_millis;\n        if (this._reportErrorStreak === 0 &&\n            this._useClockState &&\n            !this._clockState.isReady()) {\n            reportInterval = Math.min(constants.CLOCK_STATE_REFRESH_INTERVAL_MS, reportInterval);\n        }\n\n        // After 3 consecutive errors, expand the retry delay up to 8x the\n        // normal interval, jitter the delay by +/- 25%, and be sure to back off\n        // *at least* the standard reporting interval in the case of an error.\n        let backOff = 1 + Math.min(7, Math.max(0, this._reportErrorStreak));\n        let basis = backOff * reportInterval;\n        let jitter = 1.0 + (Math.random() * 0.5 - 0.25);\n        let delay = Math.floor(Math.max(0, jitter * basis));\n\n        this._debug(`Delaying next flush for ${delay}ms`);\n        this._reportTimer = util.detachedTimeout(() => {\n            this._reportTimer = null;\n            this._flushReport(false, false, done);\n        }, delay);\n    }\n\n    /**\n     * Internal worker for a flush of buffered data into a report.\n     *\n     * @param  {bool} manual - this is a manually invoked flush request. Don't\n     *         override this call with a clock state syncing flush, for example.\n     * @param  {bool} detached - this is an \"at exit\" flush that should not block\n     *         the calling process in any manner. This is specifically called\n     *         \"detached\" due to the browser use case where the report is done,\n     *         not just asynchronously, but as a script request that continues\n     *         to run even if the page is navigated away from mid-request.\n     * @param  {function} done - standard callback function called on success\n     *         or error.\n     */\n    _flushReport(manual, detached, done) {\n        done = done || function (err) {};\n\n        let clockReady = this._clockState.isReady();\n        let clockOffsetMicros = this._clockState.offsetMicros();\n\n        // Diagnostic information on the clock correction\n        this._debug('time correction state', {\n            offset_micros  : clockOffsetMicros,\n            active_samples : this._clockState.activeSampleCount(),\n            ready          : clockReady,\n        });\n\n        let spanRecords = this._spanRecords;\n        let counters = this._counters;\n        let internalLogs = this._internalLogs;\n\n        // If the clock is not ready, do an \"empty\" flush to build more clock\n        // samples before the real data is reported.\n        // A detached flush (i.e. one intended to fire at exit or other \"last\n        // ditch effort\" event) should always use the real data.\n        if (this._useClockState && !manual && !clockReady && !detached) {\n            this._debug('Flushing empty report to prime clock state');\n            spanRecords = [];\n            counters    = {};\n            internalLogs = [];\n        } else {\n            // Early out if we can.\n            if (this._buffersAreEmpty()) {\n                this._debug('Skipping empty report');\n                return done(null);\n            }\n\n            // Clear the object buffers as the data is now in the local\n            // variables\n            this._clearBuffers();\n            this._debug(`Flushing report (${spanRecords.length} spans)`);\n        }\n\n        this._transport.ensureConnection(this._options);\n\n        // Ensure the runtime GUID is set as it is possible buffer logs and\n        // spans before the GUID is necessarily set.\n        console.assert(this._runtimeGUID !== null, 'No runtime GUID for Tracer'); // eslint-disable-line no-console\n\n        let timestampOffset = this._useClockState ? clockOffsetMicros : 0;\n        let now = this._platform.nowMicros();\n        let report = new ReportImp(this._runtime, this._reportYoungestMicros, now,\n            spanRecords, internalLogs, counters, timestampOffset);\n\n        this.emit('prereport', report);\n        let originMicros = this._platform.nowMicros();\n\n        if (this._options.meta_event_reporting && !this._first_report_has_run) {\n            this._first_report_has_run = true;\n            this.startSpan(constants.SPL_META_TRACER_CREATE, {\n                tags: {\n                    [constants.SPL_META_EVENT_KEY]: true,\n                    [constants.SPL_META_TRACER_GUID_KEY]: this._runtimeGUID,\n                },\n            }).finish();\n        }\n\n        this._transport.report(detached, this._auth, report, (err, res) => {\n            let destinationMicros = this._platform.nowMicros();\n            let reportWindowSeconds = (now - report.oldest_micros) / 1e6;\n\n            if (err) {\n                // How many errors in a row? Influences the report backoff.\n                this._reportErrorStreak++;\n\n                // On a failed report, re-enqueue the data that was going to be\n                // sent.\n                let errString;\n                if (err.message) {\n                    errString = `${err.message}`;\n                } else {\n                    errString = `${err}`;\n                }\n                this._warn(`Error in report: ${errString}`, {\n                    last_report_seconds_ago : reportWindowSeconds,\n                });\n\n                this._restoreRecords(\n                    report.getSpanRecords(),\n                    report.getInternalLogs(),\n                    report.getCounters());\n\n                // Increment the counter *after* the counters are restored\n                this._counters['reports.errors.send']++;\n\n                this.emit('report_error', err, {\n                    error    : err,\n                    streak   : this._reportErrorStreak,\n                    detached : detached,\n                });\n            } else {\n                if (this.verbosity() >= 4) {\n                    this._debug(`Report flushed for last ${reportWindowSeconds} seconds`, {\n                        spans_reported : report.getSpanRecords().length,\n                    });\n                }\n\n                // Update internal data after the successful report\n                this._reportErrorStreak = 0;\n                this._reportYoungestMicros = now;\n\n                // Update the clock state if there's info from the report\n                if (res) {\n                    if (res.timing && res.timing.receive_micros && res.timing.transmit_micros) {\n                        this._clockState.addSample(\n                            originMicros,\n                            res.timing.receive_micros,\n                            res.timing.transmit_micros,\n                            destinationMicros);\n                    } else {\n                        // The response does not have timing information. Disable\n                        // the clock state assuming there'll never be timing data\n                        // to use.\n                        this._useClockState = false;\n                    }\n\n                    if (res.errors && res.errors.length > 0) {\n                        this._warn('Errors in report', res.errors);\n                    }\n\n                    if (res.commandsList && res.commandsList.length > 0) {\n                        if (res.commandsList[0].devMode && this.options().disable_meta_event_reporting !== true) {\n                            this.options().meta_event_reporting = true;\n                        }\n                    }\n                } else {\n                    this._useClockState = false;\n                }\n\n                this.emit('report', report, res);\n            }\n            return done(err);\n        });\n    }\n\n    //-----------------------------------------------------------------------//\n    // Stats and metrics\n    //-----------------------------------------------------------------------//\n\n    /**\n     * Internal API that returns some internal metrics.\n     */\n    stats() {\n        return {\n            counters : this._counters,\n        };\n    }\n\n    //-----------------------------------------------------------------------//\n    // Internal logging & errors\n    //-----------------------------------------------------------------------//\n    // The rules for how internal logs are processed:\n    //\n    // * Internal logs that are included in the Collector report:\n    //      - Always send errors logs along with the reports\n    //      - Never include any other logs\n    // * Internal logs that are echoed to the host application:\n    //      - See the README.md :)\n    //\n    _debug(msg, payload) {\n        if (this.verbosity() < 4) {\n            return;\n        }\n        this._options.logger('debug', msg, payload);\n    }\n\n    _info(msg, payload) {\n        if (this.verbosity() < 3) {\n            return;\n        }\n        this._options.logger('info', msg, payload);\n    }\n\n    _warn(msg, payload) {\n        this._counters['internal.warnings']++;\n\n        if (this.verbosity() < 3) {\n            return;\n        }\n        this._options.logger('warn', msg, payload);\n    }\n\n    _error(msg, payload) {\n        this._counters['internal.errors']++;\n\n        // Internal errors are always reported to the collector\n        let record = this.log()\n            .level(constants.LOG_ERROR)\n            .message(msg)\n            .payload(payload)\n            .record();\n        this._pushInternalLog(record);\n\n        // Internal errors are reported to the host console conditionally based\n        // on the verbosity level.\n        let verbosity = this.verbosity();\n        if (verbosity === 0) {\n            return;\n        }\n\n        // Error messages are throttled in verbosity === 1 mode\n        const now = Date.now();\n        if (verbosity === 1) {\n            const nextVisible = this._lastVisibleErrorMillis + this._options.error_throttle_millis;\n            if (now < nextVisible) {\n                this._skippedVisibleErrors++;\n                return;\n            }\n            if (this._skippedVisibleErrors > 0) {\n                /* eslint-disable max-len */\n                const s = `${this._skippedVisibleErrors} errors masked since last logged error. Increase 'verbosity' option to see all errors.`;\n                /* eslint-enable max-len */\n                this._options.logger('error', s, payload);\n            }\n        }\n\n        this._options.logger('error', msg, payload);\n        this._lastVisibleErrorMillis = now;\n        this._skippedVisibleErrors = 0;\n    }\n\n    _printToConsole(level, msg, payload) {\n        let method = 'log';\n        let message = `[Splunk:INFO] ${msg}`;\n        if (level === 'debug') {\n            method = 'log';\n            message = `[Splunk:DEBUG] ${msg}`;\n        } else if (level === 'info') {\n            method = 'log';\n            message = `[Splunk:INFO] ${msg}`;\n        } else if (level === 'warn') {\n            method = 'warn';\n            message = `[Splunk:WARN] ${msg}`;\n        } else if (level === 'error') {\n            method = 'error';\n            message = `[Splunk:ERROR] ${msg}`;\n        }\n\n        // Internal option to silence intentional errors generated by the unit\n        // tests.\n        if (this._options.silent) {\n            return;\n        }\n\n        if (payload !== undefined) {\n            console[method](message, payload); // eslint-disable-line no-console\n        }  else {\n            console[method](message); // eslint-disable-line no-console\n        }\n    }\n\n    _pushInternalLog(record) {\n        if (!record) {\n            return;\n        }\n        if (this._internalLogs.length >= MAX_INTERNAL_LOGS) {\n            record.message = `MAX_INTERNAL_LOGS limit hit. Last error: ${record.message}`;\n            this._internalLogs[this._internalLogs.length - 1] = record;\n        } else {\n            this._internalLogs.push(record);\n        }\n    }\n}\n","import _each from '../../_each';\n\n// How many updates before a sample is considered old. This happens to\n// be one less than the number of samples in our buffer but that's\n// somewhat arbitrary.\nconst kMaxOffsetAge = 7;\n\nconst kStoredSamplesTTLMicros = 60 * 60 * 1000 * 1000; // 1 hour\n\nclass ClockState {\n\n    constructor(opts) {\n        this._nowMicros     = opts.nowMicros;\n        this._localStoreGet = opts.localStoreGet;\n        this._localStoreSet = opts.localStoreSet;\n\n        // The last eight samples, computed from timing information in\n        // RPCs.\n        this._samples = [];\n        this._currentOffsetMicros = 0;\n\n        // How many updates since we've updated currentOffsetMicros.\n        this._currentOffsetAge = kMaxOffsetAge + 1;\n\n        // Try to load samples from the local store.\n        // Only use the data if it's recent.\n        let storedData = this._localStoreGet();\n        if (storedData &&\n            storedData.timestamp_micros &&\n            storedData.timestamp_micros > this._nowMicros() - kStoredSamplesTTLMicros) {\n            // Make sure there are no more than (kMaxOffsetAge+1) elements\n            this._samples = storedData.samples.slice(-(kMaxOffsetAge + 1));\n        }\n        // Update the current offset based on these data.\n        this.update();\n    }\n\n    // Add a new timing sample and update the offset.\n    addSample(originMicros,\n              receiveMicros,\n              transmitMicros,\n              destinationMicros\n    ) {\n        let latestDelayMicros = Number.MAX_VALUE;\n        let latestOffsetMicros = 0;\n        // Ensure that all of the data are valid before using them. If\n        // not, we'll push a {0, MAX} record into the queue.\n        if (originMicros > 0 && receiveMicros > 0 &&\n            transmitMicros > 0 && destinationMicros > 0) {\n            latestDelayMicros = (destinationMicros - originMicros) -\n                (transmitMicros - receiveMicros);\n            latestOffsetMicros = ((receiveMicros - originMicros) +\n                           (transmitMicros - destinationMicros)) / 2;\n        }\n\n        // Discard the oldest sample and push the new one.\n        if (this._samples.length === kMaxOffsetAge + 1) {\n            this._samples.shift();\n        }\n        this._samples.push({\n            delayMicros  : latestDelayMicros,\n            offsetMicros : latestOffsetMicros,\n        });\n        this._currentOffsetAge++;\n\n        // Update the local store with this new sample.\n        this._localStoreSet({\n            timestamp_micros : this._nowMicros(),\n            samples          : this._samples,\n        });\n        this.update();\n    }\n\n    // Update the time offset based on the current samples.\n    update() {\n        // This is simplified version of the clock filtering in Simple\n        // NTP. It ignores precision and dispersion (frequency error). In\n        // brief, it keeps the 8 (kMaxOffsetAge+1) most recent\n        // delay-offset pairs, and considers the offset with the smallest\n        // delay to be the best one. However, it only uses this new offset\n        // if the change (relative to the last offset) is small compared\n        // to the estimated error.\n        //\n        // See:\n        // https://tools.ietf.org/html/rfc5905#appendix-A.5.2\n        // http://books.google.com/books?id=pdTcJBfnbq8C\n        //   esp. section 3.5\n        // http://www.eecis.udel.edu/~mills/ntp/html/filter.html\n        // http://www.eecis.udel.edu/~mills/database/brief/algor/algor.pdf\n        // http://www.eecis.udel.edu/~mills/ntp/html/stats.html\n\n        // TODO: Consider huff-n'-puff if the delays are highly asymmetric.\n        // http://www.eecis.udel.edu/~mills/ntp/html/huffpuff.html\n\n        // Find the sample with the smallest delay; the corresponding\n        // offset is the \"best\" one.\n        let minDelayMicros = Number.MAX_VALUE;\n        let bestOffsetMicros = 0;\n        _each(this._samples, (sample) => {\n            if (sample.delayMicros < minDelayMicros) {\n                minDelayMicros = sample.delayMicros;\n                bestOffsetMicros = sample.offsetMicros;\n            }\n        });\n\n        // No update.\n        if (bestOffsetMicros === this._currentOffsetMicros) {\n            return;\n        }\n\n        // Now compute the jitter, i.e. the error relative to the new\n        // offset were we to use it.\n        let jitter = 0;\n        _each(this._samples, (sample) => {\n            jitter += Math.pow(bestOffsetMicros - sample.offsetMicros, 2);\n        });\n        jitter = Math.sqrt(jitter / this._samples.length);\n\n        // Ignore spikes: only use the new offset if the change is not too\n        // large... unless the current offset is too old. The \"too old\"\n        // condition is also triggered when update() is called from the\n        // constructor.\n        const kSGATE = 3; // See RFC 5905\n        if (this._currentOffsetAge > kMaxOffsetAge ||\n            Math.abs(this._currentOffsetMicros - bestOffsetMicros) < kSGATE * jitter) {\n            this._currentOffsetMicros = bestOffsetMicros;\n            this._currentOffsetAge = 0;\n        }\n    }\n\n    // Returns the difference in microseconds between the server's clock\n    // and our clock. This should be added to any local timestamps before\n    // sending them to the server. Note that a negative offset means that\n    // the local clock is ahead of the server's.\n    offsetMicros() {\n        return Math.floor(this._currentOffsetMicros);\n    }\n\n    // Returns true if we've performed enough measurements to be confident\n    // in the current offset.\n    isReady() {\n        return this._samples.length > 3;\n    }\n\n    activeSampleCount() {\n        return this._samples.length;\n    }\n}\n\nmodule.exports = ClockState;\n","class Util {\n    // Similar to a regular setTimeout() call, but dereferences the timer so the\n    // program execution will not be held up by this timer.\n    detachedTimeout(callback, delay) {\n        let timer = setTimeout(callback, delay);\n        if (timer.unref) {\n            timer.unref();\n        }\n        return timer;\n    }\n\n    shouldSendMetaSpan(opts, tags) {\n        let shouldSendSpan = opts.meta_event_reporting === true && tags['splunk.meta_event'] !== true;\n        return shouldSendSpan;\n    }\n}\n\nexport default new Util();\n","import Tracer from './imp/tracer_imp';\nimport { Platform } from './platform_abstraction_layer';\n\nconst library = {\n    Tracer : Tracer,\n};\n\nPlatform.initLibrary(library);\nmodule.exports = library;\n","/* global PLATFORM_BROWSER */\n\n// Hide the differences in how the Thrift compiler generates code for the\n// different platforms as well as expose a Platform class to abstract a few\n// general differences in the platforms.\nif ((typeof PLATFORM_BROWSER !== 'undefined') && PLATFORM_BROWSER) {\n    module.exports = {\n        Platform        : require('./imp/platform/browser/platform_browser.js'),\n        HTTPTransport  : require('./imp/platform/browser/transport_httpjson.js'),\n    };\n} else {\n    module.exports = {\n        Platform        : require('./imp/platform/node/platform_node.js'),\n        HTTPTransport  : require('./imp/platform/node/transport_httpjson.js'),\n    };\n}\n","import _each from '../_each';\n\nclass InstrumentPageLoad {\n    constructor() {\n        this._inited = false;\n        this._span = null;\n    }\n\n    name() {\n        return 'instrument_page_load';\n    }\n\n    addOptions(tracerImp) {\n        tracerImp.addOption('instrument_page_load', { type : 'bool', defaultValue : false });\n    }\n\n    start(tracerImp) {\n        if (this._inited) {\n            return;\n        }\n        this._inited = true;\n\n        if (typeof window !== 'object' || typeof document !== 'object') {\n            return;\n        }\n\n        const currentOptions = tracerImp.options();\n        if (currentOptions.instrument_page_load) {\n            this._ensureSpanStarted(tracerImp);\n            document.addEventListener('readystatechange', this._handleReadyStateChange.bind(this));\n        }\n    }\n\n    stop() {\n    }\n\n    _ensureSpanStarted(tracerImp) {\n        if (!this._span) {\n            this._span = tracerImp.startSpan('document/load');\n            tracerImp.addActiveRootSpan(this._span);\n        }\n    }\n\n    _handleReadyStateChange() {\n        if (!this._span) {\n            return;\n        }\n\n        let span = this._span;\n        let state = document.readyState;\n        let payload = undefined;\n        if (state === 'complete') {\n            payload = {};\n            if (window.performance && performance.timing) {\n                this._addTimingSpans(span, performance.timing);\n                payload['window.performance.timing'] = performance.timing;\n            }\n        }\n\n        span.logEvent(`document.readystatechange ${state}`, payload);\n\n        if (state === 'complete') {\n            if (span.tracer()) {\n                span.tracer().removeActiveRootSpan(span.tracer());\n            }\n            span.finish();\n        }\n    }\n\n    _copyNavigatorProperties(nav) {\n        let dst = {};\n        for (let key in nav) { // eslint-disable-line guard-for-in\n            try {\n                let value = nav[key];\n                switch (key) {\n\n                case 'plugins': {\n                    let p = [];\n                    for (let i = 0; i < value.length; i++) {\n                        let item = value.item(i);\n                        p.push({\n                            name        : item.name,\n                            description : item.description,\n                        });\n                    }\n                    dst[key] = p;\n                } break;\n\n                case 'mimeTypes': {\n                    let p = [];\n                    for (let i = 0; i < value.length; i++) {\n                        let item = value.item(i);\n                        p.push({\n                            type        : item.type,\n                            description : item.description,\n                            suffixes    : item.suffixes,\n                        });\n                    }\n                    dst[key] = p;\n                } break;\n\n                default:\n                    dst[key] = value;\n                    break;\n                }\n            } catch (e) {\n                // Skip, just in case\n            }\n        }\n        return dst;\n    }\n\n    // Retroactively create the appropriate spans and logs\n    _addTimingSpans(parentImp, timing) {\n        // NOTE: this currently relies on LightStep-specific APIs\n        if (!parentImp) {\n            return;\n        }\n\n        parentImp.setTag('user_agent', navigator.userAgent);\n\n        _each(timing, (value, key) => {\n            // e.g. secureConnectionStart is not always set\n            if (typeof value !== 'number' || value === 0) {\n                return;\n            }\n\n            let payload = undefined;\n\n            if (key === 'navigationStart' && typeof navigator === 'object') {\n                payload = {\n                    navigator : this._copyNavigatorProperties(navigator),\n                };\n            }\n            parentImp.log({\n                message : `document ${key}`,\n                payload : payload,\n            }, value);\n        });\n\n        parentImp.setBeginMicros(timing.navigationStart * 1000.0);\n\n        parentImp.tracer().startSpan('document/time_to_first_byte', { childOf : parentImp })\n            .setBeginMicros(timing.requestStart * 1000.0)\n            .setEndMicros(timing.responseStart * 1000.0)\n            .finish();\n        parentImp.tracer()\n            .startSpan('document/response_transfer', { childOf : parentImp })\n            .setBeginMicros(timing.responseStart * 1000.0)\n            .setEndMicros(timing.responseEnd * 1000.0)\n            .finish();\n        parentImp.tracer().startSpan('document/dom_load', { childOf : parentImp })\n            .setBeginMicros(timing.domLoading * 1000.0)\n            .setEndMicros(timing.domInteractive * 1000.0)\n            .finish();\n    }\n}\n\nmodule.exports = new InstrumentPageLoad();\n","import * as opentracing from 'opentracing';\n\n// Capture the proxied values on script load (i.e. ASAP) in case there are\n// multiple layers of instrumentation.\nlet proxiedFetch;\nif (typeof window === 'object' && typeof window.fetch !== 'undefined') {\n    proxiedFetch = window.fetch;\n}\n\nfunction getCookies() {\n    if (typeof document === 'undefined' || !document.cookie) {\n        return null;\n    }\n    let cookies = document.cookie.split(';');\n    let data = {};\n    let count = 0;\n    for (let i = 0; i < cookies.length; i++) {\n        let parts = cookies[i].split('=', 2);\n        if (parts.length === 2) {\n            let key = parts[0].replace(/^\\s+/, '').replace(/\\s+$/, '');\n            data[key] = decodeURIComponent(parts[1]);\n            try {\n                data[key] = JSON.parse(data[key]);\n            } catch (_ignored) { /* Ignored */ }\n            count++;\n        }\n    }\n    if (count > 0) {\n        return data;\n    }\n    return null;\n}\n\n// Normalize the getAllResponseHeaders output\nfunction getResponseHeaders(response) {\n    const result = {};\n    for (let pair of response.headers.entries()) {\n        result[pair[0]] = pair[1];\n    }\n    return result;\n}\n\n// Automatically create spans for all requests made via window.fetch.\n//\n// NOTE: this code currently works only with a single Tracer.\n//\nclass InstrumentFetch {\n    constructor() {\n        this._enabled = this._isValidContext();\n        this._proxyInited = false;\n        this._internalExclusions = [];\n        this._tracer = null;\n        this._handleOptions = this._handleOptions.bind(this);\n\n        if (!this._enabled) {\n            return;\n        }\n    }\n\n    name() {\n        return 'instrument_fetch';\n    }\n\n    addOptions(tracerImp) {\n        tracerImp.addOption('fetch_instrumentation', { type : 'bool', defaultValue : false });\n        tracerImp.addOption('fetch_url_inclusion_patterns', { type : 'array', defaultValue : [/.*/] });\n        tracerImp.addOption('fetch_url_exclusion_patterns', { type : 'array', defaultValue : [] });\n        tracerImp.addOption('include_cookies', { type : 'bool', defaultValue : true });\n    }\n\n    start(tracerImp) {\n        if (!this._enabled) {\n            return;\n        }\n        this._tracer = tracerImp;\n\n        let currentOptions = tracerImp.options();\n        this._addServiceHostToExclusions(currentOptions);\n        this._handleOptions({}, currentOptions);\n        tracerImp.on('options', this._handleOptions);\n    }\n\n    stop() {\n        if (!this._enabled) {\n            return;\n        }\n        window.fetch = proxiedFetch;\n    }\n\n    /**\n     * Respond to options changes on the Tracer.\n     *\n     * Note that `modified` is the options that have changed in this call,\n     * along with their previous and new values. `current` is the full set of\n     * current options *including* the newly modified values.\n     */\n    _handleOptions(modified, current) {\n        // Automatically add the service host itself to the list of exclusions\n        // to avoid reporting on the reports themselves\n        let serviceHost = modified.collector_host;\n        if (serviceHost) {\n            this._addServiceHostToExclusions(current);\n        }\n\n        // Set up the proxied fetch calls unless disabled\n        if (!this._proxyInited && current.fetch_instrumentation) {\n            this._proxyInited = true;\n            window.fetch = this._instrumentFetch();\n        }\n    }\n\n    /**\n     * Ensure that the reports to the collector don't get instrumented as well,\n     * as that recursive instrumentation is more confusing than valuable!\n     */\n    _addServiceHostToExclusions(opts) {\n        if (opts.collector_host.length === 0) {\n            return;\n        }\n\n        // http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\n        function escapeRegExp(str) {\n            return (`${str}`).replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n        }\n\n        // Check against the hostname without the port as well as the canonicalized\n        // URL may drop the standard port.\n        let host = escapeRegExp(opts.collector_host);\n        let port = escapeRegExp(opts.collector_port);\n        let set = [new RegExp(`^https?://${host}:${port}`)];\n        if (port === '80') {\n            set.push(new RegExp(`^http://${host}`));\n        } else if (port === '443') {\n            set.push(new RegExp(`^https://${host}`));\n        }\n        this._internalExclusions = set;\n    }\n\n    /**\n     * Check preconditions for the auto-instrumentation of fetch to work properly.\n     * There are a lot of potential JavaScript platforms.\n     */\n    _isValidContext() {\n        if (typeof window === 'undefined') {\n            return false;\n        }\n        if (!window.fetch) {\n            return false;\n        }\n        return true;\n    }\n\n    _instrumentFetch() {\n        let self = this;\n        let tracer = this._tracer;\n\n        return function (request, options = {}) {\n            const url = typeof request === 'string' ? request : request.url;\n            const opts = tracer.options();\n\n            if (!self._shouldTrace(tracer, url)) {\n                return proxiedFetch.apply(null, arguments);\n            }\n\n            let span = tracer.startSpan('fetch');\n            tracer.addActiveRootSpan(span);\n\n            let tags = {\n                method : options && options.method ? options.method : 'GET',\n                url    : url,\n            };\n            if (url) {\n                tags.url_pathname = url.split('?')[0];\n            }\n\n            const fetchPayload = Object.assign({}, tags);\n            if (opts.include_cookies) {\n                fetchPayload.cookies = getCookies();\n            }\n\n            options.headers = new Headers(options.headers);\n            // Add Open-Tracing headers\n            const headersCarrier = {};\n            tracer.inject(span.context(), opentracing.FORMAT_HTTP_HEADERS, headersCarrier);\n            const keys = Object.keys(headersCarrier);\n            keys.forEach((key) => {\n                options.headers.append(key, headersCarrier[key]);\n            });\n            span.log({\n                event       : 'sending',\n                method      : options.method || 'GET',\n                url         : url,\n                openPayload : fetchPayload,\n            });\n            span.addTags(tags);\n\n            return proxiedFetch(request, options).then((response) => {\n                if (!response.ok) {\n                    span.addTags({ error : true });\n                }\n                span.log({\n                    method       : options.method || 'GET',\n                    headers      : getResponseHeaders(response),\n                    status       : response.status,\n                    statusText   : response.statusText,\n                    responseType : response.type,\n                    url          : response.url,\n                });\n                tracer.removeActiveRootSpan(span);\n                span.finish();\n                return response;\n            }).catch((e) => {\n                span.addTags({ error : true });\n                tracer.removeActiveRootSpan(span);\n                span.log({\n                    event : 'error',\n                    error : e,\n                });\n                span.finish();\n                throw e;\n            });\n        };\n    }\n\n    _shouldTrace(tracer, url) {\n        // This shouldn't be possible, but let's be paranoid\n        if (!tracer) {\n            return false;\n        }\n\n        let opts = tracer.options();\n        if (opts.disabled) {\n            return false;\n        }\n        if (!url) {\n            return false;\n        }\n        for (let key in this._internalExclusions) {\n            if (!this._internalExclusions.hasOwnProperty(key)) {\n                continue;\n            }\n            const ex = this._internalExclusions[key];\n            if (ex.test(url)) {\n                return false;\n            }\n        }\n        let include = false;\n        for (let key in opts.fetch_url_inclusion_patterns) {\n            if (!opts.fetch_url_inclusion_patterns.hasOwnProperty(key)) {\n                continue;\n            }\n            const inc = opts.fetch_url_inclusion_patterns[key];\n            if (inc.test(url)) {\n                include = true;\n                break;\n            }\n        }\n        if (!include) {\n            return false;\n        }\n        for (let key in opts.fetch_url_exclusion_patterns) {\n            if (!opts.fetch_url_exclusion_patterns.hasOwnProperty(key)) {\n                continue;\n            }\n            const ex = opts.fetch_url_exclusion_patterns[key];\n            if (ex.test(url)) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\n\nmodule.exports = new InstrumentFetch();\n","import _each from '../_each';\nimport * as opentracing from 'opentracing';\n\n// Capture the proxied values on script load (i.e. ASAP) in case there are\n// multiple layers of instrumentation.\nlet proxied = {};\nif (typeof window === 'object' && typeof window.XMLHttpRequest !== 'undefined') {\n    proxied = {\n        XMLHttpRequest   : XMLHttpRequest,\n        open             : XMLHttpRequest.prototype.open,\n        send             : XMLHttpRequest.prototype.send,\n        setRequestHeader : XMLHttpRequest.prototype.setRequestHeader,\n    };\n}\n\nfunction getCookies() {\n    if (typeof document === 'undefined' || !document.cookie) {\n        return null;\n    }\n    let cookies = document.cookie.split(';');\n    let data = {};\n    let count = 0;\n    for (let i = 0; i < cookies.length; i++) {\n        let parts = cookies[i].split('=', 2);\n        if (parts.length === 2) {\n            let key = parts[0].replace(/^\\s+/, '').replace(/\\s+$/, '');\n            data[key] = decodeURIComponent(parts[1]);\n            try {\n                data[key] = JSON.parse(data[key]);\n            } catch (_ignored) { /* Ignored */ }\n            count++;\n        }\n    }\n    if (count > 0) {\n        return data;\n    }\n    return null;\n}\n\n// Normalize the getAllResponseHeaders output\nfunction getResponseHeaders(xhr) {\n    let raw = xhr.getAllResponseHeaders();\n    let parts = raw.replace(/\\s+$/, '').split(/\\n/);\n    for (let i = 0; i < parts.length; i++) {\n        parts[i] = parts[i].replace(/\\r/g, '').replace(/^\\s+/, '').replace(/\\s+$/, '');\n    }\n    return parts;\n}\n\n// Automatically create spans for all XMLHttpRequest objects.\n//\n// NOTE: this code currently works only with a single Tracer.\n//\nclass InstrumentXHR {\n    constructor() {\n        this._enabled = this._isValidContext();\n        this._proxyInited = false;\n        this._internalExclusions = [];\n        this._tracer = null;\n        this._handleOptions = this._handleOptions.bind(this);\n\n        if (!this._enabled) {\n            return;\n        }\n    }\n\n    name() {\n        return 'instrument_xhr';\n    }\n\n    addOptions(tracerImp) {\n        tracerImp.addOption('xhr_instrumentation', { type : 'bool', defaultValue : false });\n        tracerImp.addOption('xhr_url_inclusion_patterns', { type : 'array', defaultValue : [/.*/] });\n        tracerImp.addOption('xhr_url_exclusion_patterns', { type : 'array', defaultValue : [] });\n        tracerImp.addOption('include_cookies', { type : 'bool', defaultValue : true });\n    }\n\n    start(tracerImp) {\n        if (!this._enabled) {\n            return;\n        }\n        this._tracer = tracerImp;\n\n        let currentOptions = tracerImp.options();\n        this._addServiceHostToExclusions(currentOptions);\n        this._handleOptions({}, currentOptions);\n        tracerImp.on('options', this._handleOptions);\n    }\n\n    stop() {\n        if (!this._enabled) {\n            return;\n        }\n        let proto = proxied.XMLHttpRequest.prototype;\n        proto.open = proxied.open;\n        proto.send = proxied.send;\n    }\n\n    /**\n     * Respond to options changes on the Tracer.\n     *\n     * Note that `modified` is the options that have changed in this call,\n     * along with their previous and new values. `current` is the full set of\n     * current options *including* the newly modified values.\n     */\n    _handleOptions(modified, current) {\n        // Automatically add the service host itself to the list of exclusions\n        // to avoid reporting on the reports themselves\n        let serviceHost = modified.collector_host;\n        if (serviceHost) {\n            this._addServiceHostToExclusions(current);\n        }\n\n        // Set up the proxied XHR calls unless disabled\n        if (!this._proxyInited && current.xhr_instrumentation) {\n            this._proxyInited = true;\n            let proto = proxied.XMLHttpRequest.prototype;\n            proto.setRequestHeader = this._instrumentSetRequestHeader();\n            proto.open = this._instrumentOpen();\n            proto.send = this._instrumentSend();\n        }\n    }\n\n    /**\n     * Ensure that the reports to the collector don't get instrumented as well,\n     * as that recursive instrumentation is more confusing than valuable!\n     */\n    _addServiceHostToExclusions(opts) {\n        if (opts.collector_host.length === 0) {\n            return;\n        }\n\n        // http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\n        function escapeRegExp(str) {\n            return (`${str}`).replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n        }\n\n        // Check against the hostname without the port as well as the canonicalized\n        // URL may drop the standard port.\n        let host = escapeRegExp(opts.collector_host);\n        let port = escapeRegExp(opts.collector_port);\n        let set = [new RegExp(`^https?://${host}:${port}`)];\n        if (port === '80') {\n            set.push(new RegExp(`^http://${host}`));\n        } else if (port === '443') {\n            set.push(new RegExp(`^https://${host}`));\n        }\n        this._internalExclusions = set;\n    }\n\n    /**\n     * Check preconditions for the auto-instrumentation of XHRs to work properly.\n     * There are a lot of potential JavaScript platforms.\n     */\n    _isValidContext() {\n        if (typeof window === 'undefined') {\n            return false;\n        }\n        if (!window.XMLHttpRequest) {\n            return false;\n        }\n        if (!window.XMLHttpRequest.prototype) {\n            return false;\n        }\n        return true;\n    }\n\n    _instrumentSetRequestHeader() {\n        return function (header, value) {\n            this.__requestHeaders = this.__requestHeaders || {};\n            this.__requestHeaders[header] = value;\n            return proxied.setRequestHeader.apply(this, arguments);\n        };\n    }\n\n    _instrumentOpen() {\n        let self = this;\n        let tracer = this._tracer;\n\n        return function (method, url, asyncArg, user, password) {\n            if (!self._shouldTrace(tracer, this, url)) {\n                return proxied.open.apply(this, arguments);\n            }\n            const opts = tracer.options();\n\n            let span = tracer.startSpan('XMLHttpRequest');\n            tracer.addActiveRootSpan(span);\n            this.__tracer_span = span;\n            this.__tracer_url = url;\n\n            let tags = {\n                method : method,\n                url    : url,\n                async  : asyncArg,\n                user   : user,\n            };\n            if (url) {\n                tags.url_pathname = url.split('?')[0];\n            }\n\n            let openPayload = {};\n            _each(tags, (val, key) => {\n                openPayload[key] = val;\n            });\n            if (opts.include_cookies) {\n                openPayload.cookies = getCookies();\n            }\n\n            // Note: async defaults to true\n            let async = (asyncArg === undefined ? true : asyncArg);\n            if (async) {\n                this.addEventListener('readystatechange', function () {\n                    if (this.readyState === 0) {\n                        span.log({\n                            readyState : 0,\n                            event      : 'unsent',\n                        });\n                    } else if (this.readyState === 1) {\n                        span.log({\n                            readyState : 1,\n                            event      : 'sending',\n                        });\n                    } else if (this.readyState === 2) {\n                        span.log({\n                            readyState  : 2,\n                            event       : 'headers received',\n                            method      : method,\n                            url         : url,\n                            openPayload : openPayload,\n                            headers     : getResponseHeaders(this),\n                        });\n                        span.addTags(tags);\n                    } else if (this.readyState === 3) {\n                        span.log({\n                            readyState : 3,\n                            event      : 'loading',\n                        });\n                    } else if (this.readyState === 4) {\n                        let responseType = this.responseType;\n                        span.log({\n                            readyState   : 4,\n                            url          : url,\n                            method       : method,\n                            headers      : getResponseHeaders(this),\n                            status       : this.status,\n                            statusText   : this.statusText,\n                            responseType : responseType,\n                        });\n                        tracer.removeActiveRootSpan(span);\n                        span.finish();\n                    } else {\n                        span.log({\n                            readyState : this.readyState,\n                        });\n                    }\n                });\n            }\n\n            let result = proxied.open.apply(this, arguments);\n            if (!async) {\n                tracer.removeActiveRootSpan(span);\n                span.finish();\n            }\n            return result;\n        };\n    }\n\n    _instrumentSend() {\n        let self = this;\n        let tracer = this._tracer;\n        return function () {\n            if (!self._shouldTrace(tracer, this, this.__tracer_url)) {\n                return proxied.send.apply(this, arguments);\n            }\n\n            let span = this.__tracer_span;\n            if (!span) {\n                return proxied.send.apply(this, arguments);\n            }\n\n            let data = Array.prototype.slice.call(arguments);\n            let len = undefined;\n            if (data.length === 1) {\n                if (data[0] && data[0].length) {\n                    len = data[0].length;\n                }\n                try {\n                    data = JSON.parse(data[0]);\n                } catch (e) {\n                    // Ignore the error\n                }\n            }\n            let lenStr = (len === undefined) ? '' : `, data length=${len}`;\n            span.log({\n                event       : 'send',\n                data_length : lenStr,\n            });\n\n            // Add Open-Tracing headers\n            const headersCarrier = {};\n            tracer.inject(span.context(), opentracing.FORMAT_HTTP_HEADERS, headersCarrier);\n            const keys = Object.keys(headersCarrier);\n            keys.forEach((key) => {\n                proxied.setRequestHeader.call(this, key, headersCarrier[key]);\n            });\n\n            return proxied.send.apply(this, arguments);\n        };\n    }\n\n    _shouldTrace(tracer, xhr, url) {\n        // This shouldn't be possible, but let's be paranoid\n        if (!tracer) {\n            return false;\n        }\n\n        let opts = tracer.options();\n        if (opts.disabled) {\n            return false;\n        }\n        if (!url) {\n            return false;\n        }\n        for (let key in this._internalExclusions) {\n            if (!this._internalExclusions.hasOwnProperty(key)) {\n                continue;\n            }\n            const ex = this._internalExclusions[key];\n            if (ex.test(url)) {\n                return false;\n            }\n        }\n        let include = false;\n        for (let key in opts.xhr_url_inclusion_patterns) {\n            if (!opts.xhr_url_inclusion_patterns.hasOwnProperty(key)) {\n                continue;\n            }\n            const inc = opts.xhr_url_inclusion_patterns[key];\n            if (inc.test(url)) {\n                include = true;\n                break;\n            }\n        }\n        if (!include) {\n            return false;\n        }\n        for (let key in opts.xhr_url_exclusion_patterns) {\n            if (!opts.xhr_url_exclusion_patterns.hasOwnProperty(key)) {\n                continue;\n            }\n            const ex = opts.xhr_url_exclusion_patterns[key];\n            if (ex.test(url)) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\n\nmodule.exports = new InstrumentXHR();\n","const constants = require('../constants');\n\nclass LogToConsole {\n    constructor() {\n        this._enabled = false;\n        this._tracer = null;\n        this._optionsCb = this._handleOptions.bind(this);\n        this._logAddedCb = this._handleLogAdded.bind(this);\n    }\n\n    name() {\n        return 'log_to_console';\n    }\n\n    addOptions(tracerImp) {\n        tracerImp.addOption('log_to_console', {\n            type         : 'bool',\n            defaultValue : false,\n        });\n        tracerImp.on('options', this._optionsCb);\n    }\n\n    start(tracer, tracerImp) {\n        this._tracer = tracer;\n    }\n\n    stop() {\n        this._tracer.removeListener('options', this._optionsCb);\n    }\n\n    _handleOptions(modified, current, tracerImp) {\n        let enabled = current.log_to_console;\n        if (this._enabled === enabled) {\n            return;\n        }\n        this._enabled = enabled;\n        if (this._enabled) {\n            tracerImp.on('log_added', this._logAddedCb);\n        } else {\n            tracerImp.removeListener('log_added', this._logAddedCb);\n        }\n    }\n\n    _handleLogAdded(record) {\n        let level = constants.LOG_STRING_TO_LEVEL[record.level];\n        let message = record.message;\n\n        // Ignore records without a message (e.g. a stable_name log record)\n        if (!message) {\n            return;\n        }\n\n        let payload = record.payload_json;\n        if (payload) {\n            try {\n                payload = JSON.parse(payload);\n            } catch (_ignored) { /* ignored */ }\n        }\n\n        switch (level) {\n        case constants.LOG_ERROR:\n        case constants.LOG_FATAL:\n            if (payload !== undefined) {\n                console.error(message, payload); // eslint-disable-line no-console\n            } else {\n                console.error(message); // eslint-disable-line no-console\n            }\n            break;\n        case constants.LOG_WARN:\n            if (payload !== undefined) {\n                console.warn(message, payload); // eslint-disable-line no-console\n            } else {\n                console.warn(message); // eslint-disable-line no-console\n            }\n            break;\n        case constants.LOG_INFO:\n        default:\n            if (payload !== undefined) {\n                console.log(message, payload); // eslint-disable-line no-console\n            } else {\n                console.log(message); // eslint-disable-line no-console\n            }\n            break;\n        }\n    }\n}\n\nmodule.exports = new LogToConsole();\n"],"sourceRoot":""}